'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactState = require('react-state');

var _reactMove = require('react-move');

var _d3Shape = require('d3-shape');

var _Utils = require('../utils/Utils');

var _Utils2 = _interopRequireDefault(_Utils);

var _Curves = require('../utils/Curves');

var _Curves2 = _interopRequireDefault(_Curves);

var _interactionMethods = require('../utils/interactionMethods');

var _Path = require('../primitives/Path');

var _Path2 = _interopRequireDefault(_Path);

var _Circle = require('../primitives/Circle');

var _Circle2 = _interopRequireDefault(_Circle);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

//


var pathDefaultStyle = {
  strokeWidth: 2
};

var circleDefaultStyle = {
  r: 2
};

var Line = function (_PureComponent) {
  _inherits(Line, _PureComponent);

  function Line() {
    _classCallCheck(this, Line);

    var _this = _possibleConstructorReturn(this, (Line.__proto__ || Object.getPrototypeOf(Line)).call(this));

    _this.selectSeries = _interactionMethods.selectSeries.bind(_this);
    _this.hoverSeries = _interactionMethods.hoverSeries.bind(_this);
    _this.selectDatum = _interactionMethods.selectDatum.bind(_this);
    _this.hoverDatum = _interactionMethods.hoverDatum.bind(_this);
    return _this;
  }

  _createClass(Line, [{
    key: 'render',
    value: function render() {
      var _this2 = this;

      var _props = this.props,
          series = _props.series,
          visibility = _props.visibility,
          showPoints = _props.showPoints,
          curve = _props.curve,
          selected = _props.selected,
          hovered = _props.hovered,
          interaction = _props.interaction;


      var status = _Utils2.default.seriesStatus(series, hovered, selected);
      var style = _Utils2.default.getStatusStyle(status, series.statusStyles);

      var lineFn = (0, _d3Shape.line)().curve(_Curves2.default[curve] || curve).defined(function (d) {
        return typeof d[0] === 'number' && typeof d[1] === 'number';
      });

      var data = series.data.map(function (d) {
        return {
          x: d.x,
          y: d.y,
          r: d.r,
          base: d.base
        };
      });

      return _react2.default.createElement(
        _reactMove.Animate,
        {
          'default': {
            data: data,
            visibility: 0
          },
          data: {
            data: data,
            visibility: visibility
          },
          duration: 500,
          ignore: ['originalData']
        },
        function (inter) {
          var path = lineFn(inter.data.map(function (d) {
            return [isNaN(d.x) ? null : d.x, isNaN(d.y) ? null : d.y];
          }));

          var seriesInteractionProps = interaction === 'series' ? {
            onClick: function onClick() {
              return _this2.selectSeries(series);
            },
            onMouseEnter: function onMouseEnter() {
              return _this2.hoverSeries(series);
            },
            onMouseMove: function onMouseMove() {
              return _this2.hoverSeries(series);
            },
            onMouseLeave: function onMouseLeave() {
              return _this2.hoverSeries(null);
            }
          } : {};

          return _react2.default.createElement(
            'g',
            null,
            _react2.default.createElement(_Path2.default, _extends({
              d: path,
              style: _extends({}, pathDefaultStyle, style, style.line, {
                fill: 'none'
              }),
              opacity: inter.visibility
            }, seriesInteractionProps)),
            showPoints && series.data.map(function (datum, i) {
              var status = _Utils2.default.datumStatus(series, datum, hovered, selected);
              var dataStyle = _Utils2.default.getStatusStyle(status, datum.statusStyles);

              var datumInteractionProps = interaction === 'element' ? {
                onClick: function onClick() {
                  return _this2.selectDatum(datum);
                },
                onMouseEnter: function onMouseEnter() {
                  return _this2.hoverDatum(datum);
                },
                onMouseMove: function onMouseMove() {
                  return _this2.hoverDatum(datum);
                },
                onMouseLeave: function onMouseLeave() {
                  return _this2.hoverDatum(null);
                }
              } : {};

              return _react2.default.createElement(_Circle2.default, _extends({
                key: i,
                x: inter.data[i].x,
                y: inter.data[i].y,
                style: _extends({}, circleDefaultStyle, style, style.circle, dataStyle, dataStyle.circle),
                opacity: inter.visibility
              }, seriesInteractionProps, datumInteractionProps));
            })
          );
        }
      );
    }
  }]);

  return Line;
}(_react.PureComponent);

Line.defaultProps = {
  showPoints: true,
  curve: 'monotoneX'
};
exports.default = (0, _reactState.Connect)(function (state, props) {
  return {
    hovered: state.hovered,
    selected: state.selected,
    interaction: state.interaction
  };
}, {
  filter: function filter(oldState, newState, meta) {
    return meta.type !== 'cursor';
  },
  statics: {
    SeriesType: 'Line'
  }
})(Line);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL0xpbmUuanMiXSwibmFtZXMiOlsicGF0aERlZmF1bHRTdHlsZSIsInN0cm9rZVdpZHRoIiwiY2lyY2xlRGVmYXVsdFN0eWxlIiwiciIsIkxpbmUiLCJzZWxlY3RTZXJpZXMiLCJiaW5kIiwiaG92ZXJTZXJpZXMiLCJzZWxlY3REYXR1bSIsImhvdmVyRGF0dW0iLCJwcm9wcyIsInNlcmllcyIsInZpc2liaWxpdHkiLCJzaG93UG9pbnRzIiwiY3VydmUiLCJzZWxlY3RlZCIsImhvdmVyZWQiLCJpbnRlcmFjdGlvbiIsInN0YXR1cyIsInNlcmllc1N0YXR1cyIsInN0eWxlIiwiZ2V0U3RhdHVzU3R5bGUiLCJzdGF0dXNTdHlsZXMiLCJsaW5lRm4iLCJkZWZpbmVkIiwiZCIsImRhdGEiLCJtYXAiLCJ4IiwieSIsImJhc2UiLCJwYXRoIiwiaW50ZXIiLCJpc05hTiIsInNlcmllc0ludGVyYWN0aW9uUHJvcHMiLCJvbkNsaWNrIiwib25Nb3VzZUVudGVyIiwib25Nb3VzZU1vdmUiLCJvbk1vdXNlTGVhdmUiLCJsaW5lIiwiZmlsbCIsImRhdHVtIiwiaSIsImRhdHVtU3RhdHVzIiwiZGF0YVN0eWxlIiwiZGF0dW1JbnRlcmFjdGlvblByb3BzIiwiY2lyY2xlIiwiZGVmYXVsdFByb3BzIiwic3RhdGUiLCJmaWx0ZXIiLCJvbGRTdGF0ZSIsIm5ld1N0YXRlIiwibWV0YSIsInR5cGUiLCJzdGF0aWNzIiwiU2VyaWVzVHlwZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBRUE7Ozs7QUFDQTs7OztBQUVBOztBQVFBOzs7O0FBQ0E7Ozs7Ozs7Ozs7OztBQUZBOzs7QUFJQSxJQUFNQSxtQkFBbUI7QUFDdkJDLGVBQWE7QUFEVSxDQUF6Qjs7QUFJQSxJQUFNQyxxQkFBcUI7QUFDekJDLEtBQUc7QUFEc0IsQ0FBM0I7O0lBSU1DLEk7OztBQUtKLGtCQUFlO0FBQUE7O0FBQUE7O0FBRWIsVUFB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QU1qQyxRQUZYO0FBR0xFLGlCQUFhK0IsTUFBTS9CO0FBSGQsR0FBUDtBQUtELENBUFksRUFRYjtBQUNFZ0MsVUFBUSxnQkFBQ0MsUUFBRCxFQUFXQyxRQUFYLEVBQXFCQyxJQUFyQjtBQUFBLFdBQThCQSxLQUFLQyxJQUFMLEtBQWMsUUFBNUM7QUFBQSxHQURWO0FBRUVDLFdBQVM7QUFDUEMsZ0JBQVk7QUFETDtBQUZYLENBUmEsRUFjYm5ELElBZGEsQyIsImZpbGUiOiJMaW5lLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFB1cmVDb21wb25lbnQgfSBmcm9tICdyZWFjdCdcbmltcG9ydCB7IENvbm5lY3QgfSBmcm9tICdyZWFjdC1zdGF0ZSdcbmltcG9ydCB7IEFuaW1hdGUgfSBmcm9tICdyZWFjdC1tb3ZlJ1xuXG5pbXBvcnQgeyBsaW5lIH0gZnJvbSAnZDMtc2hhcGUnXG5cbmltcG9ydCBVdGlscyBmcm9tICcuLi91dGlscy9VdGlscydcbmltcG9ydCBDdXJ2ZXMgZnJvbSAnLi4vdXRpbHMvQ3VydmVzJ1xuXG5pbXBvcnQge1xuICBzZWxlY3RTZXJpZXMsXG4gIHNlbGVjdERhdHVtLFxuICBob3ZlclNlcmllcyxcbiAgaG92ZXJEYXR1bSxcbn0gZnJvbSAnLi4vdXRpbHMvaW50ZXJhY3Rpb25NZXRob2RzJ1xuXG4vL1xuaW1wb3J0IFBhdGggZnJvbSAnLi4vcHJpbWl0aXZlcy9QYXRoJ1xuaW1wb3J0IENpcmNsZSBmcm9tICcuLi9wcmltaXRpdmVzL0NpcmNsZSdcblxuY29uc3QgcGF0aERlZmF1bHRTdHlsZSA9IHtcbiAgc3Ryb2tlV2lkdGg6IDIsXG59XG5cbmNvbnN0IGNpcmNsZURlZmF1bHRTdHlsZSA9IHtcbiAgcjogMixcbn1cblxuY2xhc3MgTGluZSBleHRlbmRzIFB1cmVDb21wb25lbnQge1xuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHNob3dQb2ludHM6IHRydWUsXG4gICAgY3VydmU6ICdtb25vdG9uZVgnLFxuICB9XG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcigpXG4gICAgdGhpcy5zZWxlY3RTZXJpZXMgPSBzZWxlY3RTZXJpZXMuYmluZCh0aGlzKVxuICAgIHRoaXMuaG92ZXJTZXJpZXMgPSBob3ZlclNlcmllcy5iaW5kKHRoaXMpXG4gICAgdGhpcy5zZWxlY3REYXR1bSA9IHNlbGVjdERhdHVtLmJpbmQodGhpcylcbiAgICB0aGlzLmhvdmVyRGF0dW0gPSBob3ZlckRhdHVtLmJpbmQodGhpcylcbiAgfVxuICByZW5kZXIgKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIHNlcmllcyxcbiAgICAgIHZpc2liaWxpdHksXG4gICAgICBzaG93UG9pbnRzLFxuICAgICAgY3VydmUsXG4gICAgICAvL1xuICAgICAgc2VsZWN0ZWQsXG4gICAgICBob3ZlcmVkLFxuICAgICAgaW50ZXJhY3Rpb24sXG4gICAgfSA9IHRoaXMucHJvcHNcblxuICAgIGNvbnN0IHN0YXR1cyA9IFV0aWxzLnNlcmllc1N0YXR1cyhzZXJpZXMsIGhvdmVyZWQsIHNlbGVjdGVkKVxuICAgIGNvbnN0IHN0eWxlID0gVXRpbHMuZ2V0U3RhdHVzU3R5bGUoc3RhdHVzLCBzZXJpZXMuc3RhdHVzU3R5bGVzKVxuXG4gICAgY29uc3QgbGluZUZuID0gbGluZSgpXG4gICAgICAuY3VydmUoQ3VydmVzW2N1cnZlXSB8fCBjdXJ2ZSlcbiAgICAgIC5kZWZpbmVkKGQgPT4gdHlwZW9mIGRbMF0gPT09ICdudW1iZXInICYmIHR5cGVvZiBkWzFdID09PSAnbnVtYmVyJylcblxuICAgIGNvbnN0IGRhdGEgPSBzZXJpZXMuZGF0YS5tYXAoZCA9PiAoe1xuICAgICAgeDogZC54LFxuICAgICAgeTogZC55LFxuICAgICAgcjogZC5yLFxuICAgICAgYmFzZTogZC5iYXNlLFxuICAgIH0pKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxBbmltYXRlXG4gICAgICAgIGRlZmF1bHQ9e3tcbiAgICAgICAgICBkYXRhLFxuICAgICAgICAgIHZpc2liaWxpdHk6IDAsXG4gICAgICAgIH19XG4gICAgICAgIGRhdGE9e3tcbiAgICAgICAgICBkYXRhLFxuICAgICAgICAgIHZpc2liaWxpdHksXG4gICAgICAgIH19XG4gICAgICAgIGR1cmF0aW9uPXs1MDB9XG4gICAgICAgIGlnbm9yZT17WydvcmlnaW5hbERhdGEnXX1cbiAgICAgID5cbiAgICAgICAge2ludGVyID0+IHtcbiAgICAgICAgICBjb25zdCBwYXRoID0gbGluZUZuKFxuICAgICAgICAgICAgaW50ZXIuZGF0YS5tYXAoZCA9PiBbXG4gICAgICAgICAgICAgIGlzTmFOKGQueCkgPyBudWxsIDogZC54LFxuICAgICAgICAgICAgICBpc05hTihkLnkpID8gbnVsbCA6IGQueSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuXG4gICAgICAgICAgY29uc3Qgc2VyaWVzSW50ZXJhY3Rpb25Qcm9wcyA9XG4gICAgICAgICAgICBpbnRlcmFjdGlvbiA9PT0gJ3NlcmllcydcbiAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gdGhpcy5zZWxlY3RTZXJpZXMoc2VyaWVzKSxcbiAgICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI6ICgpID0+IHRoaXMuaG92ZXJTZXJpZXMoc2VyaWVzKSxcbiAgICAgICAgICAgICAgICBvbk1vdXNlTW92ZTogKCkgPT4gdGhpcy5ob3ZlclNlcmllcyhzZXJpZXMpLFxuICAgICAgICAgICAgICAgIG9uTW91c2VMZWF2ZTogKCkgPT4gdGhpcy5ob3ZlclNlcmllcyhudWxsKSxcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA6IHt9XG5cbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGc+XG4gICAgICAgICAgICAgIDxQYXRoXG4gICAgICAgICAgICAgICAgZD17cGF0aH1cbiAgICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgICAgLi4ucGF0aERlZmF1bHRTdHlsZSxcbiAgICAgICAgICAgICAgICAgIC4uLnN0eWxlLFxuICAgICAgICAgICAgICAgICAgLi4uc3R5bGUubGluZSxcbiAgICAgICAgICAgICAgICAgIGZpbGw6ICdub25lJyxcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIG9wYWNpdHk9e2ludGVyLnZpc2liaWxpdHl9XG4gICAgICAgICAgICAgICAgey4uLnNlcmllc0ludGVyYWN0aW9uUHJvcHN9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIHtzaG93UG9pbnRzICYmXG4gICAgICAgICAgICAgICAgc2VyaWVzLmRhdGEubWFwKChkYXR1bSwgaSkgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gVXRpbHMuZGF0dW1TdGF0dXMoXG4gICAgICAgICAgICAgICAgICAgIHNlcmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0dW0sXG4gICAgICAgICAgICAgICAgICAgIGhvdmVyZWQsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICBjb25zdCBkYXRhU3R5bGUgPSBVdGlscy5nZXRTdGF0dXNTdHlsZShcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXR1bS5zdGF0dXNTdHlsZXNcbiAgICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgICAgICAgY29uc3QgZGF0dW1JbnRlcmFjdGlvblByb3BzID1cbiAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb24gPT09ICdlbGVtZW50J1xuICAgICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gdGhpcy5zZWxlY3REYXR1bShkYXR1bSksXG4gICAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI6ICgpID0+IHRoaXMuaG92ZXJEYXR1bShkYXR1bSksXG4gICAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlTW92ZTogKCkgPT4gdGhpcy5ob3ZlckRhdHVtKGRhdHVtKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uTW91c2VMZWF2ZTogKCkgPT4gdGhpcy5ob3ZlckRhdHVtKG51bGwpLFxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICA6IHt9XG5cbiAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgIDxDaXJjbGVcbiAgICAgICAgICAgICAgICAgICAgICBrZXk9e2l9XG4gICAgICAgICAgICAgICAgICAgICAgeD17aW50ZXIuZGF0YVtpXS54fVxuICAgICAgICAgICAgICAgICAgICAgIHk9e2ludGVyLmRhdGFbaV0ueX1cbiAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uY2lyY2xlRGVmYXVsdFN0eWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgLi4uc3R5bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5zdHlsZS5jaXJjbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5kYXRhU3R5bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5kYXRhU3R5bGUuY2lyY2xlLFxuICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eT17aW50ZXIudmlzaWJpbGl0eX1cbiAgICAgICAgICAgICAgICAgICAgICB7Li4uc2VyaWVzSW50ZXJhY3Rpb25Qcm9wc31cbiAgICAgICAgICAgICAgICAgICAgICB7Li4uZGF0dW1JbnRlcmFjdGlvblByb3BzfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC9nPlxuICAgICAgICAgIClcbiAgICAgICAgfX1cbiAgICAgIDwvQW5pbWF0ZT5cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ29ubmVjdChcbiAgKHN0YXRlLCBwcm9wcykgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBob3ZlcmVkOiBzdGF0ZS5ob3ZlcmVkLFxuICAgICAgc2VsZWN0ZWQ6IHN0YXRlLnNlbGVjdGVkLFxuICAgICAgaW50ZXJhY3Rpb246IHN0YXRlLmludGVyYWN0aW9uLFxuICAgIH1cbiAgfSxcbiAge1xuICAgIGZpbHRlcjogKG9sZFN0YXRlLCBuZXdTdGF0ZSwgbWV0YSkgPT4gbWV0YS50eXBlICE9PSAnY3Vyc29yJyxcbiAgICBzdGF0aWNzOiB7XG4gICAgICBTZXJpZXNUeXBlOiAnTGluZScsXG4gICAgfSxcbiAgfVxuKShMaW5lKVxuIl19