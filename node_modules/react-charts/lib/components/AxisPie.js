'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.positionLeft = exports.positionBottom = exports.positionRight = exports.positionTop = undefined;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _reactState = require('react-state');

var _d3Shape = require('d3-shape');

var _Selectors = require('../utils/Selectors');

var _Selectors2 = _interopRequireDefault(_Selectors);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }
//


// const fontSize = 10

var positionTop = exports.positionTop = 'top';
var positionRight = exports.positionRight = 'right';
var positionBottom = exports.positionBottom = 'bottom';
var positionLeft = exports.positionLeft = 'left';

var AxisPie = function (_PureComponent) {
  _inherits(AxisPie, _PureComponent);

  // Lifecycle
  function AxisPie() {
    _classCallCheck(this, AxisPie);

    // this.measure = measure.bind(this)
    var _this = _possibleConstructorReturn(this, (AxisPie.__proto__ || Object.getPrototypeOf(AxisPie)).call(this));

    _this.updateScale = _this.updateScale.bind(_this);
    return _this;
  }

  _createClass(AxisPie, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(newProps) {
      var oldProps = this.props;

      // If any of the following change,
      // we need to update the axis
      if (newProps.materializedData !== oldProps.materializedData || newProps.height !== oldProps.height || newProps.width !== oldProps.width) {
        this.updateScale(newProps);
      }
    }
  }, {
    key: 'componentDidMount',
    value: function componentDidMount() {
      this.updateScale(this.props);
      // this.measure()
    }
  }, {
    key: 'shouldComponentUpdate',
    value: function shouldComponentUpdate(newProps) {
      if (newProps.axis !== this.props.axis) {
        return true;
      }
      return false;
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate() {
      // RAF(() => {
      //   if (!this.measure()) {
      //     window.setTimeout(() => this.componentDidUpdate(), 1)
      //   }
      // })
    }
  }, {
    key: 'updateScale',
    value: function updateScale(props) {
      var type = props.type,
          id = props.id,
          materializedData = props.materializedData,
          cutoutPercentage = props.cutoutPercentage,
          width = props.width,
          height = props.height,
          dispatch = props.dispatch,
          outerPadding = props.outerPadding,
          cornerRadius = props.cornerRadius,
          arcPadding = props.arcPadding,
          seriesPadding = props.seriesPadding;
      // We need the data to proceed

      if (!materializedData) {
        return;
      }

      var midX = width / 2;
      var midY = height / 2;
      var radius = Math.min(midX, midY) - outerPadding;

      var outerRadius = radius;
      var innerRadius = radius * cutoutPercentage;
      var totalRadius = outerRadius - innerRadius;
      var seriesRadius = totalRadius / materializedData.length;
      var arcPaddingRadius = outerRadius * arcPadding * 20;
      var seriesPaddingRadius = totalRadius * seriesPadding / 2.5;
      var padAngle = 0.01;

      var data = materializedData.map(function (series) {
        var seriesInnerRadius = innerRadius + seriesRadius * series.index;
        var seriesOuterRadius = seriesRadius + seriesInnerRadius;
        var preData = series.data.map(function (d) {
          return {
            x: d.primary,
            y: d.secondary
          };
        });
        var pie = (0, _d3Shape.pie)().sort(null).padAngle(padAngle).value(function (d) {
          return d.y;
        });
        var pieData = pie(preData);
        return pieData.map(function (d) {
          var arcData = {
            startAngle: d.startAngle,
            endAngle: d.endAngle,
            padAngle: d.padAngle,
            padRadius: arcPaddingRadius,
            innerRadius: seriesInnerRadius + seriesPaddingRadius,
            outerRadius: seriesOuterRadius,
            cornerRadius: cornerRadius
          };
          // Calculate the arc for the centroid
          var arc = (0, _d3Shape.arc)().startAngle(arcData.startAngle).endAngle(arcData.endAngle).padAngle(arcData.padAngle).padRadius(arcPaddingRadius).innerRadius(seriesInnerRadius + seriesPaddingRadius).outerRadius(seriesOuterRadius).cornerRadius(cornerRadius);
          var centroid = arc.centroid();
          return {
            x: centroid[0] + midX,
            y: centroid[1] + midY
          };
        });
      });

      var primaryScale = function primaryScale(d) {
        return data[d.seriesIndex] ? data[d.seriesIndex][d.index] ? data[d.seriesIndex][d.index] : 0 : 0;
      };
      var secondaryScale = function secondaryScale(d) {
        return data[d.seriesIndex] ? data[d.seriesIndex][d.index] ? data[d.seriesIndex][d.index] : 0 : 0;
      };
      primaryScale.range = function () {
        return [0, width];
      };
      secondaryScale.range = function () {
        return [height, 0];
      };

      var primaryAxis = {
        id: id,
        scale: primaryScale,
        cutoutPercentage: cutoutPercentage,
        type: type,
        primary: true,
        format: function format(d) {
          return d;
        },
        width: width,
        height: height,
        radius: radius,
        cornerRadius: cornerRadius,
        arcPadding: arcPadding,
        seriesPadding: seriesPadding,
        outerRadius: outerRadius,
        innerRadius: innerRadius,
        totalRadius: totalRadius,
        seriesRadius: seriesRadius,
        arcPaddingRadius: arcPaddingRadius,
        seriesPaddingRadius: seriesPaddingRadius,
        padAngle: padAngle
      };

      var secondaryAxis = {
        id: id,
        scale: secondaryScale,
        format: function format(d) {
          return d;
        },
        type: type
      };

      dispatch(function (state) {
        return _extends({}, state, {
          axes: {
            pie_primary: primaryAxis,
            pie_secondary: secondaryAxis
          }
        });
      }, {
        type: 'axisUpdateScale'
      });
    }
  }, {
    key: 'render',
    value: function render() {
      // TODO: This is where permanent labels and lines will be drawn
      return null;
    }
  }]);

  return AxisPie;
}(_react.PureComponent);

AxisPie.defaultProps = {
  tickArguments: [],
  tickValues: null,
  tickFormat: null,
  tickSizeInner: 6,
  tickSizeOuter: 6,
  tickPadding: 3,
  cutoutPercentage: 0.5,
  outerPadding: 10,
  cornerRadius: 1,
  arcPadding: 0.2,
  seriesPadding: 0.2
};
exports.default = (0, _reactState.Connect)(function () {
  var selectors = {
    gridWidth: _Selectors2.default.gridWidth(),
    gridHeight: _Selectors2.default.gridHeight()
  };
  return function (state, props) {
    return {
      materializedData: state.materializedData,
      width: selectors.gridWidth(state),
      height: selectors.gridHeight(state)
    };
  };
}, {
  filter: function filter(oldState, newState, meta) {
    return meta.type !== 'cursor';
  }
})(AxisPie);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL0F4aXNQaWUuanMiXSwibmFtZXMiOlsicG9zaXRpb25Ub3AiLCJwb3NpdGlvblJpZ2h0IiwicG9zaXRpb25Cb3R0b20iLCJwb3NpdGlvbkxlZnQiLCJBeGlzUGllIiwidXBkYXRlU2NhbGUiLCJiaW5kIiwibmV3UHJvcHMiLCJvbGRQcm9wcyIsInByb3BzIiwibWF0ZXJpYWxpemVkRGF0YSIsImhlaWdodCIsIndpZHRoIiwiYXhpcyIsInR5cGUiLCJpZCIsImN1dG91dFBlcmNlbnRhZ2UiLCJkaXNwYXRjaCIsIm91dGVyUGFkZGluZyIsImNvcm5lclJhZGl1cyIsImFyY1BhZGRpbmciLCJzZXJpZXNQYWRkaW5nIiwibWlkWCIsIm1pZFkiLCJyYWRpdXMiLCJNYXRoIiwibWluIiwib3V0ZXJSYWRpdXMiLCJpbm5lclJhZGl1cyIsInRvdGFsUmFkaXVzIiwic2VyaWVzUmFkaXVzIiwibGVuZ3RoIiwiYXJjUGFkZGluZ1JhZGl1cyIsInNlcmllc1BhZGRpbmdSYWRpdXMiLCJwYWRBbmdsZSIsImRhdGEiLCJtYXAiLCJzZXJpZXNJbm5lclJhZGl1cyIsInNlcmllcyIsImluZGV4Iiwic2VyaWVzT3V0ZXJSYWRpdXMiLCJwcmVEYXRhIiwieCIsImQiLCJwcmltYXJ5IiwieSIsInNlY29uZGFyeSIsInBpZSIsInNvcnQiLCJ2YWx1ZSIsInBpZURhdGEiLCJhcmNEYXRhIiwic3RhcnRBbmdsZSIsImVuZEFuZ2xlIiwicGFkUmFkaXVzIiwiYXJjIiwiY2VudHJvaWQiLCJwcmltYXJ5U2NhbGUiLCJzZXJpZXNJbmRleCIsInNlY29uZGFyeVNjYWxlIiwicmFuZ2UiLCJwcmltYXJ5QXhpcyIsInNjYWxlIiwiZm9ybWF0Iiwic2Vjb25kYXJ5QXhpcyIsInN0YXRlIiwiYXhlcyIsInBpZV9wcmltYXJ5IiwicGllX3NlY29uZGFyeSIsImRlZmF1bHRQcm9wcyIsInRpY2tBcmd1bWVudHMiLCJ0aWNrVmFsdWVzIiwidGlja0Zvcm1hdCIsInRpY2tTaXplSW5uZXIiLCJ0aWNrU2l6ZU91dGVyIiwidGlja1BhZGRpbmciLCJzZWxlY3RvcnMiLCJncmlkV2lkdGgiLCJncmlkSGVpZ2h0IiwiZmlsdGVyIiwib2xkU3RhdGUiLCJuZXdTdGF0ZSIsIm1ldGEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7Ozs7Ozs7O0FBREE7OztBQUdBOztBQUVPLElBQU1BLG9DQUFjLEtBQXBCO0FBQ0EsSUFBTUMsd0NBQWdCLE9BQXRCO0FBQ0EsSUFBTUMsMENBQWlCLFFBQXZCO0FBQ0EsSUFBTUMsc0NBQWUsTUFBckI7O0lBRURDLE87OztBQWNKO0FBQ0EscUJBQWU7QUFBQTs7QUFFYjtBQUZhOztBQUdiLFVBQUtDLFdBQUwsR0FBbUIsTUFBS0EsV0FBTCxDQUFpQkMsSUFBakIsT0FBbkI7QUFIYTtBQUlkOzs7OzhDQUMwQkMsUSxFQUFVO0FBQ25DLFVBQU1DLFdBQVcsS0FBS0MsS0FBdEI7O0FBRUE7QUFDQTtBQUNBLFVBQ0VGLFNBQVNHLGdCQUFULEtBQThCRixTQUFTRSxnQkFBdkMsSUFDQUgsU0FBU0ksTUFBVCxLQUFvQkgsU0FBU0csTUFEN0IsSUFFQUosU0FBU0ssS0FBVCxLQUFtQkosU0FBU0ksS0FIOUIsRUFJRTtBQUNBLGFBQUtQLFdBQUwsQ0FBaUJFLFFBQWpCO0FBQ0Q7QUFDRjs7O3dDQUNvQjtBQUNuQixXQUFLRixXQUFMLENBQWlCLEtBQUtJLEtBQXRCO0FBQ0E7QUFDRDs7OzBDQUNzQkYsUSxFQUFVO0FBQy9CLFVBQUlBLFNBQVNNLElBQVQsS0FBa0IsS0FBS0osS0FBTCxDQUFXSSxJQUFqQyxFQUF1QztBQUNyQyxlQUFPLElBQVA7QUFDRDtBQUNELGFBQU8sS0FBUDtBQUNEOzs7eUNBQ3FCO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDRDs7O2dDQUNZSixLLEVBQU87QUFBQSxVQUVoQkssSUFGZ0IsR0FhZEwsS0FiYyxDQUVoQkssSUFGZ0I7QUFBQSxVQUdoQkMsRUFIZ0IsR0FhZE4s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eyBQdXJlQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBDb25uZWN0IH0gZnJvbSAncmVhY3Qtc3RhdGUnXG5pbXBvcnQgeyBhcmMgYXMgbWFrZUFyYywgcGllIGFzIG1ha2VQaWUgfSBmcm9tICdkMy1zaGFwZSdcbi8vXG5pbXBvcnQgU2VsZWN0b3JzIGZyb20gJy4uL3V0aWxzL1NlbGVjdG9ycydcblxuLy8gY29uc3QgZm9udFNpemUgPSAxMFxuXG5leHBvcnQgY29uc3QgcG9zaXRpb25Ub3AgPSAndG9wJ1xuZXhwb3J0IGNvbnN0IHBvc2l0aW9uUmlnaHQgPSAncmlnaHQnXG5leHBvcnQgY29uc3QgcG9zaXRpb25Cb3R0b20gPSAnYm90dG9tJ1xuZXhwb3J0IGNvbnN0IHBvc2l0aW9uTGVmdCA9ICdsZWZ0J1xuXG5jbGFzcyBBeGlzUGllIGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgdGlja0FyZ3VtZW50czogW10sXG4gICAgdGlja1ZhbHVlczogbnVsbCxcbiAgICB0aWNrRm9ybWF0OiBudWxsLFxuICAgIHRpY2tTaXplSW5uZXI6IDYsXG4gICAgdGlja1NpemVPdXRlcjogNixcbiAgICB0aWNrUGFkZGluZzogMyxcbiAgICBjdXRvdXRQZXJjZW50YWdlOiAwLjUsXG4gICAgb3V0ZXJQYWRkaW5nOiAxMCxcbiAgICBjb3JuZXJSYWRpdXM6IDEsXG4gICAgYXJjUGFkZGluZzogMC4yLFxuICAgIHNlcmllc1BhZGRpbmc6IDAuMixcbiAgfVxuICAvLyBMaWZlY3ljbGVcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKClcbiAgICAvLyB0aGlzLm1lYXN1cmUgPSBtZWFzdXJlLmJpbmQodGhpcylcbiAgICB0aGlzLnVwZGF0ZVNjYWxlID0gdGhpcy51cGRhdGVTY2FsZS5iaW5kKHRoaXMpXG4gIH1cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAobmV3UHJvcHMpIHtcbiAgICBjb25zdCBvbGRQcm9wcyA9IHRoaXMucHJvcHNcblxuICAgIC8vIElmIGFueSBvZiB0aGUgZm9sbG93aW5nIGNoYW5nZSxcbiAgICAvLyB3ZSBuZWVkIHRvIHVwZGF0ZSB0aGUgYXhpc1xuICAgIGlmIChcbiAgICAgIG5ld1Byb3BzLm1hdGVyaWFsaXplZERhdGEgIT09IG9sZFByb3BzLm1hdGVyaWFsaXplZERhdGEgfHxcbiAgICAgIG5ld1Byb3BzLmhlaWdodCAhPT0gb2xkUHJvcHMuaGVpZ2h0IHx8XG4gICAgICBuZXdQcm9wcy53aWR0aCAhPT0gb2xkUHJvcHMud2lkdGhcbiAgICApIHtcbiAgICAgIHRoaXMudXBkYXRlU2NhbGUobmV3UHJvcHMpXG4gICAgfVxuICB9XG4gIGNvbXBvbmVudERpZE1vdW50ICgpIHtcbiAgICB0aGlzLnVwZGF0ZVNjYWxlKHRoaXMucHJvcHMpXG4gICAgLy8gdGhpcy5tZWFzdXJlKClcbiAgfVxuICBzaG91bGRDb21wb25lbnRVcGRhdGUgKG5ld1Byb3BzKSB7XG4gICAgaWYgKG5ld1Byb3BzLmF4aXMgIT09IHRoaXMucHJvcHMuYXhpcykge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbiAgY29tcG9uZW50RGlkVXBkYXRlICgpIHtcbiAgICAvLyBSQUYoKCkgPT4ge1xuICAgIC8vICAgaWYgKCF0aGlzLm1lYXN1cmUoKSkge1xuICAgIC8vICAgICB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB0aGlzLmNvbXBvbmVudERpZFVwZGF0ZSgpLCAxKVxuICAgIC8vICAgfVxuICAgIC8vIH0pXG4gIH1cbiAgdXBkYXRlU2NhbGUgKHByb3BzKSB7XG4gICAgY29uc3Qge1xuICAgICAgdHlwZSxcbiAgICAgIGlkLFxuICAgICAgbWF0ZXJpYWxpemVkRGF0YSxcbiAgICAgIGN1dG91dFBlcmNlbnRhZ2UsXG4gICAgICB3aWR0aCxcbiAgICAgIGhlaWdodCxcbiAgICAgIGRpc3BhdGNoLFxuICAgICAgb3V0ZXJQYWRkaW5nLFxuICAgICAgY29ybmVyUmFkaXVzLFxuICAgICAgYXJjUGFkZGluZyxcbiAgICAgIHNlcmllc1BhZGRpbmcsXG4gICAgfSA9IHByb3BzXG4gICAgLy8gV2UgbmVlZCB0aGUgZGF0YSB0byBwcm9jZWVkXG4gICAgaWYgKCFtYXRlcmlhbGl6ZWREYXRhKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBtaWRYID0gd2lkdGggLyAyXG4gICAgY29uc3QgbWlkWSA9IGhlaWdodCAvIDJcbiAgICBjb25zdCByYWRpdXMgPSBNYXRoLm1pbihtaWRYLCBtaWRZKSAtIG91dGVyUGFkZGluZ1xuXG4gICAgY29uc3Qgb3V0ZXJSYWRpdXMgPSByYWRpdXNcbiAgICBjb25zdCBpbm5lclJhZGl1cyA9IHJhZGl1cyAqIGN1dG91dFBlcmNlbnRhZ2VcbiAgICBjb25zdCB0b3RhbFJhZGl1cyA9IG91dGVyUmFkaXVzIC0gaW5uZXJSYWRpdXNcbiAgICBjb25zdCBzZXJpZXNSYWRpdXMgPSB0b3RhbFJhZGl1cyAvIG1hdGVyaWFsaXplZERhdGEubGVuZ3RoXG4gICAgY29uc3QgYXJjUGFkZGluZ1JhZGl1cyA9IG91dGVyUmFkaXVzICogYXJjUGFkZGluZyAqIDIwXG4gICAgY29uc3Qgc2VyaWVzUGFkZGluZ1JhZGl1cyA9IHRvdGFsUmFkaXVzICogc2VyaWVzUGFkZGluZyAvIDIuNVxuICAgIGNvbnN0IHBhZEFuZ2xlID0gMC4wMVxuXG4gICAgY29uc3QgZGF0YSA9IG1hdGVyaWFsaXplZERhdGEubWFwKHNlcmllcyA9PiB7XG4gICAgICBjb25zdCBzZXJpZXNJbm5lclJhZGl1cyA9IGlubmVyUmFkaXVzICsgc2VyaWVzUmFkaXVzICogc2VyaWVzLmluZGV4XG4gICAgICBjb25zdCBzZXJpZXNPdXRlclJhZGl1cyA9IHNlcmllc1JhZGl1cyArIHNlcmllc0lubmVyUmFkaXVzXG4gICAgICBjb25zdCBwcmVEYXRhID0gc2VyaWVzLmRhdGEubWFwKGQgPT4gKHtcbiAgICAgICAgeDogZC5wcmltYXJ5LFxuICAgICAgICB5OiBkLnNlY29uZGFyeSxcbiAgICAgIH0pKVxuICAgICAgY29uc3QgcGllID0gbWFrZVBpZSgpLnNvcnQobnVsbCkucGFkQW5nbGUocGFkQW5nbGUpLnZhbHVlKGQgPT4gZC55KVxuICAgICAgY29uc3QgcGllRGF0YSA9IHBpZShwcmVEYXRhKVxuICAgICAgcmV0dXJuIHBpZURhdGEubWFwKGQgPT4ge1xuICAgICAgICBjb25zdCBhcmNEYXRhID0ge1xuICAgICAgICAgIHN0YXJ0QW5nbGU6IGQuc3RhcnRBbmdsZSxcbiAgICAgICAgICBlbmRBbmdsZTogZC5lbmRBbmdsZSxcbiAgICAgICAgICBwYWRBbmdsZTogZC5wYWRBbmdsZSxcbiAgICAgICAgICBwYWRSYWRpdXM6IGFyY1BhZGRpbmdSYWRpdXMsXG4gICAgICAgICAgaW5uZXJSYWRpdXM6IHNlcmllc0lubmVyUmFkaXVzICsgc2VyaWVzUGFkZGluZ1JhZGl1cyxcbiAgICAgICAgICBvdXRlclJhZGl1czogc2VyaWVzT3V0ZXJSYWRpdXMsXG4gICAgICAgICAgY29ybmVyUmFkaXVzOiBjb3JuZXJSYWRpdXMsXG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBhcmMgZm9yIHRoZSBjZW50cm9pZFxuICAgICAgICBjb25zdCBhcmMgPSBtYWtlQXJjKClcbiAgICAgICAgICAuc3RhcnRBbmdsZShhcmNEYXRhLnN0YXJ0QW5nbGUpXG4gICAgICAgICAgLmVuZEFuZ2xlKGFyY0RhdGEuZW5kQW5nbGUpXG4gICAgICAgICAgLnBhZEFuZ2xlKGFyY0RhdGEucGFkQW5nbGUpXG4gICAgICAgICAgLnBhZFJhZGl1cyhhcmNQYWRkaW5nUmFkaXVzKVxuICAgICAgICAgIC5pbm5lclJhZGl1cyhzZXJpZXNJbm5lclJhZGl1cyArIHNlcmllc1BhZGRpbmdSYWRpdXMpXG4gICAgICAgICAgLm91dGVyUmFkaXVzKHNlcmllc091dGVyUmFkaXVzKVxuICAgICAgICAgIC5jb3JuZXJSYWRpdXMoY29ybmVyUmFkaXVzKVxuICAgICAgICBjb25zdCBjZW50cm9pZCA9IGFyYy5jZW50cm9pZCgpXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgeDogY2VudHJvaWRbMF0gKyBtaWRYLFxuICAgICAgICAgIHk6IGNlbnRyb2lkWzFdICsgbWlkWSxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgY29uc3QgcHJpbWFyeVNjYWxlID0gZCA9PlxuICAgICAgZGF0YVtkLnNlcmllc0luZGV4XVxuICAgICAgICA/IGRhdGFbZC5zZXJpZXNJbmRleF1bZC5pbmRleF0gPyBkYXRhW2Quc2VyaWVzSW5kZXhdW2QuaW5kZXhdIDogMFxuICAgICAgICA6IDBcbiAgICBjb25zdCBzZWNvbmRhcnlTY2FsZSA9IGQgPT5cbiAgICAgIGRhdGFbZC5zZXJpZXNJbmRleF1cbiAgICAgICAgPyBkYXRhW2Quc2VyaWVzSW5kZXhdW2QuaW5kZXhdID8gZGF0YVtkLnNlcmllc0luZGV4XVtkLmluZGV4XSA6IDBcbiAgICAgICAgOiAwXG4gICAgcHJpbWFyeVNjYWxlLnJhbmdlID0gKCkgPT4gWzAsIHdpZHRoXVxuICAgIHNlY29uZGFyeVNjYWxlLnJhbmdlID0gKCkgPT4gW2hlaWdodCwgMF1cblxuICAgIGNvbnN0IHByaW1hcnlBeGlzID0ge1xuICAgICAgaWQsXG4gICAgICBzY2FsZTogcHJpbWFyeVNjYWxlLFxuICAgICAgY3V0b3V0UGVyY2VudGFnZSxcbiAgICAgIHR5cGUsXG4gICAgICBwcmltYXJ5OiB0cnVlLFxuICAgICAgZm9ybWF0OiBkID0+IGQsXG4gICAgICB3aWR0aCxcbiAgICAgIGhlaWdodCxcbiAgICAgIHJhZGl1cyxcbiAgICAgIGNvcm5lclJhZGl1cyxcbiAgICAgIGFyY1BhZGRpbmcsXG4gICAgICBzZXJpZXNQYWRkaW5nLFxuICAgICAgb3V0ZXJSYWRpdXMsXG4gICAgICBpbm5lclJhZGl1cyxcbiAgICAgIHRvdGFsUmFkaXVzLFxuICAgICAgc2VyaWVzUmFkaXVzLFxuICAgICAgYXJjUGFkZGluZ1JhZGl1cyxcbiAgICAgIHNlcmllc1BhZGRpbmdSYWRpdXMsXG4gICAgICBwYWRBbmdsZSxcbiAgICB9XG5cbiAgICBjb25zdCBzZWNvbmRhcnlBeGlzID0ge1xuICAgICAgaWQsXG4gICAgICBzY2FsZTogc2Vjb25kYXJ5U2NhbGUsXG4gICAgICBmb3JtYXQ6IGQgPT4gZCxcbiAgICAgIHR5cGUsXG4gICAgfVxuXG4gICAgZGlzcGF0Y2goXG4gICAgICBzdGF0ZSA9PiAoe1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgYXhlczoge1xuICAgICAgICAgIHBpZV9wcmltYXJ5OiBwcmltYXJ5QXhpcyxcbiAgICAgICAgICBwaWVfc2Vjb25kYXJ5OiBzZWNvbmRhcnlBeGlzLFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgICB7XG4gICAgICAgIHR5cGU6ICdheGlzVXBkYXRlU2NhbGUnLFxuICAgICAgfVxuICAgIClcbiAgfVxuICByZW5kZXIgKCkge1xuICAgIC8vIFRPRE86IFRoaXMgaXMgd2hlcmUgcGVybWFuZW50IGxhYmVscyBhbmQgbGluZXMgd2lsbCBiZSBkcmF3blxuICAgIHJldHVybiBudWxsXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ29ubmVjdChcbiAgKCkgPT4ge1xuICAgIGNvbnN0IHNlbGVjdG9ycyA9IHtcbiAgICAgIGdyaWRXaWR0aDogU2VsZWN0b3JzLmdyaWRXaWR0aCgpLFxuICAgICAgZ3JpZEhlaWdodDogU2VsZWN0b3JzLmdyaWRIZWlnaHQoKSxcbiAgICB9XG4gICAgcmV0dXJuIChzdGF0ZSwgcHJvcHMpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1hdGVyaWFsaXplZERhdGE6IHN0YXRlLm1hdGVyaWFsaXplZERhdGEsXG4gICAgICAgIHdpZHRoOiBzZWxlY3RvcnMuZ3JpZFdpZHRoKHN0YXRlKSxcbiAgICAgICAgaGVpZ2h0OiBzZWxlY3RvcnMuZ3JpZEhlaWdodChzdGF0ZSksXG4gICAgICB9XG4gICAgfVxuICB9LFxuICB7XG4gICAgZmlsdGVyOiAob2xkU3RhdGUsIG5ld1N0YXRlLCBtZXRhKSA9PiB7XG4gICAgICByZXR1cm4gbWV0YS50eXBlICE9PSAnY3Vyc29yJ1xuICAgIH0sXG4gIH1cbikoQXhpc1BpZSlcbiJdfQ==