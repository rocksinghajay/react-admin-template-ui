'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactMove = require('react-move');

var _reactState = require('react-state');

var _d3Shape = require('d3-shape');

var _Utils = require('../utils/Utils');

var _Utils2 = _interopRequireDefault(_Utils);

var _Curves = require('../utils/Curves');

var _Curves2 = _interopRequireDefault(_Curves);

var _interactionMethods = require('../utils/interactionMethods');

var _Path = require('../primitives/Path');

var _Path2 = _interopRequireDefault(_Path);

var _Circle = require('../primitives/Circle');

var _Circle2 = _interopRequireDefault(_Circle);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }
//


var pathDefaultStyle = {
  strokeWidth: 2
};

var circleDefaultStyle = {
  r: 2
};

var Area = function (_PureComponent) {
  _inherits(Area, _PureComponent);

  function Area() {
    _classCallCheck(this, Area);

    var _this = _possibleConstructorReturn(this, (Area.__proto__ || Object.getPrototypeOf(Area)).call(this));

    _this.selectSeries = _interactionMethods.selectSeries.bind(_this);
    _this.hoverSeries = _interactionMethods.hoverSeries.bind(_this);
    _this.selectDatum = _interactionMethods.selectDatum.bind(_this);
    _this.hoverDatum = _interactionMethods.hoverDatum.bind(_this);
    return _this;
  }

  _createClass(Area, [{
    key: 'render',
    value: function render() {
      var _this2 = this;

      var _props = this.props,
          series = _props.series,
          visibility = _props.visibility,
          showPoints = _props.showPoints,
          curve = _props.curve,
          selected = _props.selected,
          hovered = _props.hovered,
          interaction = _props.interaction;


      var status = _Utils2.default.seriesStatus(series, hovered, selected);
      var style = _Utils2.default.getStatusStyle(status, series.statusStyles);

      var areaFn = (0, _d3Shape.area)().defined(function (d) {
        return typeof d[0] === 'number' && typeof d[1] === 'number';
      }).curve(_Curves2.default[curve] || curve).y0(function (d) {
        return d[2];
      });

      var lineFn = (0, _d3Shape.line)().defined(function (d) {
        return typeof d[0] === 'number' && typeof d[1] === 'number';
      }).curve(_Curves2.default[curve] || curve);

      var data = series.data.map(function (d) {
        return {
          x: d.x,
          y: d.y,
          r: d.r,
          base: d.base
        };
      });

      return _react2.default.createElement(
        _reactMove.Animate,
        {
          'default': {
            data: data,
            visibility: 0
          },
          data: {
            data: data,
            visibility: visibility
          }
        },
        function (inter) {
          var areaPath = areaFn(inter.data.map(function (d) {
            return [isNaN(d.x) ? null : d.x, isNaN(d.y) ? null : d.y, isNaN(d.base) ? null : d.base];
          }));
          var linePath = lineFn(inter.data.map(function (d) {
            return [isNaN(d.x) ? null : d.x, isNaN(d.y) ? null : d.y];
          }));

          var seriesInteractionProps = interaction === 'series' ? {
            onClick: function onClick() {
              return _this2.selectSeries(series);
            },
            onMouseEnter: function onMouseEnter() {
              return _this2.hoverSeries(series);
            },
            onMouseMove: function onMouseMove() {
              return _this2.hoverSeries(series);
            },
            onMouseLeave: function onMouseLeave() {
              return _this2.hoverSeries(null);
            }
          } : {};

          return _react2.default.createElement(
            'g',
            null,
            _react2.default.createElement(_Path2.default, _extends({
              d: areaPath,
              style: _extends({}, pathDefaultStyle, style, style.area, {
                stroke: 'transparent'
              }),
              opacity: inter.visibility
            }, seriesInteractionProps)),
            _react2.default.createElement(_Path2.default, _extends({
              d: linePath,
              style: _extends({}, pathDefaultStyle, style, style.line, {
                fill: 'none'
              }),
              opacity: inter.visibility
            }, seriesInteractionProps)),
            showPoints && series.data.map(function (datum, i) {
              var status = _Utils2.default.datumStatus(series, datum, hovered, selected);
              var dataStyle = _Utils2.default.getStatusStyle(status, datum.statusStyles);

              var datumInteractionProps = interaction === 'element' ? {
                onClick: function onClick() {
                  return _this2.selectDatum(datum);
                },
                onMouseEnter: function onMouseEnter() {
                  return _this2.hoverDatum(datum);
                },
                onMouseMove: function onMouseMove() {
                  return _this2.hoverDatum(datum);
                },
                onMouseLeave: function onMouseLeave() {
                  return _this2.hoverDatum(null);
                }
              } : {};

              return _react2.default.createElement(_Circle2.default, _extends({
                key: i,
                x: inter.data[i].x,
                y: inter.data[i].y,
                style: _extends({}, circleDefaultStyle, style, style.circle, dataStyle, dataStyle.circle),
                opacity: inter.visibility
              }, seriesInteractionProps, datumInteractionProps));
            })
          );
        }
      );
    }
  }]);

  return Area;
}(_react.PureComponent);

Area.defaultProps = {
  showPoints: false,
  curve: 'monotoneX'
};
exports.default = (0, _reactState.Connect)(function (state, props) {
  return {
    hovered: state.hovered,
    selected: state.selected,
    interaction: state.interaction
  };
}, {
  filter: function filter(oldState, newState, meta) {
    return meta.type !== 'cursor';
  },
  statics: {
    SeriesType: 'Area'
  }
})(Area);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL0FyZWEuanMiXSwibmFtZXMiOlsicGF0aERlZmF1bHRTdHlsZSIsInN0cm9rZVdpZHRoIiwiY2lyY2xlRGVmYXVsdFN0eWxlIiwiciIsIkFyZWEiLCJzZWxlY3RTZXJpZXMiLCJiaW5kIiwiaG92ZXJTZXJpZXMiLCJzZWxlY3REYXR1bSIsImhvdmVyRGF0dW0iLCJwcm9wcyIsInNlcmllcyIsInZpc2liaWxpdHkiLCJzaG93UG9pbnRzIiwiY3VydmUiLCJzZWxlY3RlZCIsImhvdmVyZWQiLCJpbnRlcmFjdGlvbiIsInN0YXR1cyIsInNlcmllc1N0YXR1cyIsInN0eWxlIiwiZ2V0U3RhdHVzU3R5bGUiLCJzdGF0dXNTdHlsZXMiLCJhcmVhRm4iLCJkZWZpbmVkIiwiZCIsInkwIiwibGluZUZuIiwiZGF0YSIsIm1hcCIsIngiLCJ5IiwiYmFzZSIsImFyZWFQYXRoIiwiaW50ZXIiLCJpc05hTiIsImxpbmVQYXRoIiwic2VyaWVzSW50ZXJhY3Rpb25Qcm9wcyIsIm9uQ2xpY2siLCJvbk1vdXNlRW50ZXIiLCJvbk1vdXNlTW92ZSIsIm9uTW91c2VMZWF2ZSIsImFyZWEiLCJzdHJva2UiLCJsaW5lIiwiZmlsbCIsImRhdHVtIiwiaSIsImRhdHVtU3RhdHVzIiwiZGF0YVN0eWxlIiwiZGF0dW1JbnRlcmFjdGlvblByb3BzIiwiY2lyY2xlIiwiZGVmYXVsdFByb3BzIiwic3RhdGUiLCJmaWx0ZXIiLCJvbGRTdGF0ZSIsIm5ld1N0YXRlIiwibWV0YSIsInR5cGUiLCJzdGF0aWNzIiwiU2VyaWVzVHlwZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOztBQU9BOzs7O0FBQ0E7Ozs7Ozs7Ozs7O0FBWEE7OztBQWFBLElBQU1BLG1CQUFtQjtBQUN2QkMsZUFBYTtBQURVLENBQXpCOztBQUlBLElBQU1DLHFCQUFxQjtBQUN6QkMsS0FBRztBQURzQixDQUEz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LGlCQUZkO0FBR0FOLDZCQUFhO0FBQUEseUJBQU0sT0FBSy9CLFVBQUwsQ0FBZ0JxQyxLQUFoQixDQUFOO0FBQUEsaUJBSGI7QUFJQUwsOEJBQWM7QUFBQSx5QkFBTSxPQUFLaEMsVUFBTCxDQUFnQixJQUFoQixDQUFOO0FBQUE7QUFKZCxlQURKLEdBT0ksRUFSTjs7QUFVQSxxQkFDRTtBQUNFLHFCQUFLc0MsQ0FEUDtBQUVFLG1CQUFHYixNQUFNTixJQUFOLENBQVdtQixDQUFYLEVBQWNqQixDQUZuQjtBQUdFLG1CQUFHSSxNQUFNTixJQUFOLENBQVdtQixDQUFYLEVBQWNoQixDQUhuQjtBQUlFLG9DQUNLN0Isa0JBREwsRUFFS2tCLEtBRkwsRUFHS0EsTUFBTStCLE1BSFgsRUFJS0YsU0FKTCxFQUtLQSxVQUFVRSxNQUxmLENBSkY7QUFXRSx5QkFBU2pCLE1BQU10QjtBQVhqQixpQkFZTXlCLHNCQVpOLEVBYU1hLHFCQWJOLEVBREY7QUFpQkQsYUF2Q0Q7QUF4QkosV0FERjtBQW1FRDtBQXRHSCxPQURGO0FBMEdEOzs7Ozs7QUFySkc5QyxJLENBQ0dnRCxZLEdBQWU7QUFDcEJ2QyxjQUFZLEtBRFE7QUFFcEJDLFNBQU87QUFGYSxDO2tCQXVKVCx5QkFDYixVQUFDdUMsS0FBRCxFQUFRM0MsS0FBUixFQUFrQjtBQUNoQixTQUFPO0FBQ0xNLGFBQVNxQyxNQUFNckMsT0FEVjtBQUVMRCxjQUFVc0MsTUFBTXRDLFFBRlg7QUFHTEUsaUJBQWFvQyxNQUFNcEM7QUFIZCxHQUFQO0FBS0QsQ0FQWSxFQVFiO0FBQ0VxQyxVQUFRLGdCQUFDQyxRQUFELEVBQVdDLFFBQVgsRUFBcUJDLElBQXJCO0FBQUEsV0FBOEJBLEtBQUtDLElBQUwsS0FBYyxRQUE1QztBQUFBLEdBRFY7QUFFRUMsV0FBUztBQUNQQyxnQkFBWTtBQURMO0FBRlgsQ0FSYSxFQWNieEQsSUFkYSxDIiwiZmlsZSI6IkFyZWEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgUHVyZUNvbXBvbmVudCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgQW5pbWF0ZSB9IGZyb20gJ3JlYWN0LW1vdmUnXG5pbXBvcnQgeyBDb25uZWN0IH0gZnJvbSAncmVhY3Qtc3RhdGUnXG5cbmltcG9ydCB7IGFyZWEsIGxpbmUgfSBmcm9tICdkMy1zaGFwZSdcbi8vXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vdXRpbHMvVXRpbHMnXG5pbXBvcnQgQ3VydmVzIGZyb20gJy4uL3V0aWxzL0N1cnZlcydcbmltcG9ydCB7XG4gIHNlbGVjdFNlcmllcyxcbiAgc2VsZWN0RGF0dW0sXG4gIGhvdmVyU2VyaWVzLFxuICBob3ZlckRhdHVtLFxufSBmcm9tICcuLi91dGlscy9pbnRlcmFjdGlvbk1ldGhvZHMnXG5cbmltcG9ydCBQYXRoIGZyb20gJy4uL3ByaW1pdGl2ZXMvUGF0aCdcbmltcG9ydCBDaXJjbGUgZnJvbSAnLi4vcHJpbWl0aXZlcy9DaXJjbGUnXG5cbmNvbnN0IHBhdGhEZWZhdWx0U3R5bGUgPSB7XG4gIHN0cm9rZVdpZHRoOiAyLFxufVxuXG5jb25zdCBjaXJjbGVEZWZhdWx0U3R5bGUgPSB7XG4gIHI6IDIsXG59XG5cbmNsYXNzIEFyZWEgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBzaG93UG9pbnRzOiBmYWxzZSxcbiAgICBjdXJ2ZTogJ21vbm90b25lWCcsXG4gIH1cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKClcbiAgICB0aGlzLnNlbGVjdFNlcmllcyA9IHNlbGVjdFNlcmllcy5iaW5kKHRoaXMpXG4gICAgdGhpcy5ob3ZlclNlcmllcyA9IGhvdmVyU2VyaWVzLmJpbmQodGhpcylcbiAgICB0aGlzLnNlbGVjdERhdHVtID0gc2VsZWN0RGF0dW0uYmluZCh0aGlzKVxuICAgIHRoaXMuaG92ZXJEYXR1bSA9IGhvdmVyRGF0dW0uYmluZCh0aGlzKVxuICB9XG4gIHJlbmRlciAoKSB7XG4gICAgY29uc3Qge1xuICAgICAgc2VyaWVzLFxuICAgICAgdmlzaWJpbGl0eSxcbiAgICAgIHNob3dQb2ludHMsXG4gICAgICBjdXJ2ZSxcbiAgICAgIC8vXG4gICAgICBzZWxlY3RlZCxcbiAgICAgIGhvdmVyZWQsXG4gICAgICBpbnRlcmFjdGlvbixcbiAgICB9ID0gdGhpcy5wcm9wc1xuXG4gICAgY29uc3Qgc3RhdHVzID0gVXRpbHMuc2VyaWVzU3RhdHVzKHNlcmllcywgaG92ZXJlZCwgc2VsZWN0ZWQpXG4gICAgY29uc3Qgc3R5bGUgPSBVdGlscy5nZXRTdGF0dXNTdHlsZShzdGF0dXMsIHNlcmllcy5zdGF0dXNTdHlsZXMpXG5cbiAgICBjb25zdCBhcmVhRm4gPSBhcmVhKClcbiAgICAgIC5kZWZpbmVkKGQgPT4gdHlwZW9mIGRbMF0gPT09ICdudW1iZXInICYmIHR5cGVvZiBkWzFdID09PSAnbnVtYmVyJylcbiAgICAgIC5jdXJ2ZShDdXJ2ZXNbY3VydmVdIHx8IGN1cnZlKVxuICAgICAgLnkwKGQgPT4gZFsyXSlcblxuICAgIGNvbnN0IGxpbmVGbiA9IGxpbmUoKVxuICAgICAgLmRlZmluZWQoZCA9PiB0eXBlb2YgZFswXSA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGRbMV0gPT09ICdudW1iZXInKVxuICAgICAgLmN1cnZlKEN1cnZlc1tjdXJ2ZV0gfHwgY3VydmUpXG5cbiAgICBjb25zdCBkYXRhID0gc2VyaWVzLmRhdGEubWFwKGQgPT4gKHtcbiAgICAgIHg6IGQueCxcbiAgICAgIHk6IGQueSxcbiAgICAgIHI6IGQucixcbiAgICAgIGJhc2U6IGQuYmFzZSxcbiAgICB9KSlcblxuICAgIHJldHVybiAoXG4gICAgICA8QW5pbWF0ZVxuICAgICAgICBkZWZhdWx0PXt7XG4gICAgICAgICAgZGF0YSxcbiAgICAgICAgICB2aXNpYmlsaXR5OiAwLFxuICAgICAgICB9fVxuICAgICAgICBkYXRhPXt7XG4gICAgICAgICAgZGF0YSxcbiAgICAgICAgICB2aXNpYmlsaXR5LFxuICAgICAgICB9fVxuICAgICAgPlxuICAgICAgICB7aW50ZXIgPT4ge1xuICAgICAgICAgIGNvbnN0IGFyZWFQYXRoID0gYXJlYUZuKFxuICAgICAgICAgICAgaW50ZXIuZGF0YS5tYXAoZCA9PiBbXG4gICAgICAgICAgICAgIGlzTmFOKGQueCkgPyBudWxsIDogZC54LFxuICAgICAgICAgICAgICBpc05hTihkLnkpID8gbnVsbCA6IGQueSxcbiAgICAgICAgICAgICAgaXNOYU4oZC5iYXNlKSA/IG51bGwgOiBkLmJhc2UsXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICAgICAgICBjb25zdCBsaW5lUGF0aCA9IGxpbmVGbihcbiAgICAgICAgICAgIGludGVyLmRhdGEubWFwKGQgPT4gW1xuICAgICAgICAgICAgICBpc05hTihkLngpID8gbnVsbCA6IGQueCxcbiAgICAgICAgICAgICAgaXNOYU4oZC55KSA/IG51bGwgOiBkLnksXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcblxuICAgICAgICAgIGNvbnN0IHNlcmllc0ludGVyYWN0aW9uUHJvcHMgPVxuICAgICAgICAgICAgaW50ZXJhY3Rpb24gPT09ICdzZXJpZXMnXG4gICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHRoaXMuc2VsZWN0U2VyaWVzKHNlcmllcyksXG4gICAgICAgICAgICAgICAgb25Nb3VzZUVudGVyOiAoKSA9PiB0aGlzLmhvdmVyU2VyaWVzKHNlcmllcyksXG4gICAgICAgICAgICAgICAgb25Nb3VzZU1vdmU6ICgpID0+IHRoaXMuaG92ZXJTZXJpZXMoc2VyaWVzKSxcbiAgICAgICAgICAgICAgICBvbk1vdXNlTGVhdmU6ICgpID0+IHRoaXMuaG92ZXJTZXJpZXMobnVsbCksXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgOiB7fVxuXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxnPlxuICAgICAgICAgICAgICA8UGF0aFxuICAgICAgICAgICAgICAgIGQ9e2FyZWFQYXRofVxuICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAuLi5wYXRoRGVmYXVsdFN0eWxlLFxuICAgICAgICAgICAgICAgICAgLi4uc3R5bGUsXG4gICAgICAgICAgICAgICAgICAuLi5zdHlsZS5hcmVhLFxuICAgICAgICAgICAgICAgICAgc3Ryb2tlOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgb3BhY2l0eT17aW50ZXIudmlzaWJpbGl0eX1cbiAgICAgICAgICAgICAgICB7Li4uc2VyaWVzSW50ZXJhY3Rpb25Qcm9wc31cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPFBhdGhcbiAgICAgICAgICAgICAgICBkPXtsaW5lUGF0aH1cbiAgICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgICAgLi4ucGF0aERlZmF1bHRTdHlsZSxcbiAgICAgICAgICAgICAgICAgIC4uLnN0eWxlLFxuICAgICAgICAgICAgICAgICAgLi4uc3R5bGUubGluZSxcbiAgICAgICAgICAgICAgICAgIGZpbGw6ICdub25lJyxcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIG9wYWNpdHk9e2ludGVyLnZpc2liaWxpdHl9XG4gICAgICAgICAgICAgICAgey4uLnNlcmllc0ludGVyYWN0aW9uUHJvcHN9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIHtzaG93UG9pbnRzICYmXG4gICAgICAgICAgICAgICAgc2VyaWVzLmRhdGEubWFwKChkYXR1bSwgaSkgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gVXRpbHMuZGF0dW1TdGF0dXMoXG4gICAgICAgICAgICAgICAgICAgIHNlcmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0dW0sXG4gICAgICAgICAgICAgICAgICAgIGhvdmVyZWQsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICBjb25zdCBkYXRhU3R5bGUgPSBVdGlscy5nZXRTdGF0dXNTdHlsZShcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXR1bS5zdGF0dXNTdHlsZXNcbiAgICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgICAgICAgY29uc3QgZGF0dW1JbnRlcmFjdGlvblByb3BzID1cbiAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb24gPT09ICdlbGVtZW50J1xuICAgICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljazogKCkgPT4gdGhpcy5zZWxlY3REYXR1bShkYXR1bSksXG4gICAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI6ICgpID0+IHRoaXMuaG92ZXJEYXR1bShkYXR1bSksXG4gICAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlTW92ZTogKCkgPT4gdGhpcy5ob3ZlckRhdHVtKGRhdHVtKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uTW91c2VMZWF2ZTogKCkgPT4gdGhpcy5ob3ZlckRhdHVtKG51bGwpLFxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICA6IHt9XG5cbiAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgIDxDaXJjbGVcbiAgICAgICAgICAgICAgICAgICAgICBrZXk9e2l9XG4gICAgICAgICAgICAgICAgICAgICAgeD17aW50ZXIuZGF0YVtpXS54fVxuICAgICAgICAgICAgICAgICAgICAgIHk9e2ludGVyLmRhdGFbaV0ueX1cbiAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uY2lyY2xlRGVmYXVsdFN0eWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgLi4uc3R5bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5zdHlsZS5jaXJjbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5kYXRhU3R5bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5kYXRhU3R5bGUuY2lyY2xlLFxuICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eT17aW50ZXIudmlzaWJpbGl0eX1cbiAgICAgICAgICAgICAgICAgICAgICB7Li4uc2VyaWVzSW50ZXJhY3Rpb25Qcm9wc31cbiAgICAgICAgICAgICAgICAgICAgICB7Li4uZGF0dW1JbnRlcmFjdGlvblByb3BzfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC9nPlxuICAgICAgICAgIClcbiAgICAgICAgfX1cbiAgICAgIDwvQW5pbWF0ZT5cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ29ubmVjdChcbiAgKHN0YXRlLCBwcm9wcykgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBob3ZlcmVkOiBzdGF0ZS5ob3ZlcmVkLFxuICAgICAgc2VsZWN0ZWQ6IHN0YXRlLnNlbGVjdGVkLFxuICAgICAgaW50ZXJhY3Rpb246IHN0YXRlLmludGVyYWN0aW9uLFxuICAgIH1cbiAgfSxcbiAge1xuICAgIGZpbHRlcjogKG9sZFN0YXRlLCBuZXdTdGF0ZSwgbWV0YSkgPT4gbWV0YS50eXBlICE9PSAnY3Vyc29yJyxcbiAgICBzdGF0aWNzOiB7XG4gICAgICBTZXJpZXNUeXBlOiAnQXJlYScsXG4gICAgfSxcbiAgfVxuKShBcmVhKVxuIl19