'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactState = require('react-state');

var _reactMove = require('react-move');

var _Utils = require('../utils/Utils');

var _Utils2 = _interopRequireDefault(_Utils);

var _Selectors = require('../utils/Selectors');

var _Selectors2 = _interopRequireDefault(_Selectors);

var _interactionMethods = require('../utils/interactionMethods');

var _Rectangle = require('../primitives/Rectangle');

var _Rectangle2 = _interopRequireDefault(_Rectangle);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }
//


var Bars = function (_PureComponent) {
  _inherits(Bars, _PureComponent);

  function Bars() {
    _classCallCheck(this, Bars);

    var _this = _possibleConstructorReturn(this, (Bars.__proto__ || Object.getPrototypeOf(Bars)).call(this));

    _this.selectSeries = _interactionMethods.selectSeries.bind(_this);
    _this.hoverSeries = _interactionMethods.hoverSeries.bind(_this);
    _this.selectDatum = _interactionMethods.selectDatum.bind(_this);
    _this.hoverDatum = _interactionMethods.hoverDatum.bind(_this);
    return _this;
  }

  _createClass(Bars, [{
    key: 'render',
    value: function render() {
      var _this2 = this;

      var _props = this.props,
          series = _props.series,
          visibility = _props.visibility,
          primaryAxis = _props.primaryAxis,
          selected = _props.selected,
          hovered = _props.hovered,
          interaction = _props.interaction;


      var status = _Utils2.default.seriesStatus(series, hovered, selected);
      var style = _Utils2.default.getStatusStyle(status, series.statusStyles);

      var barSize = primaryAxis.barSize;
      var barOffset = primaryAxis.barOffset;

      var data = series.data.map(function (d) {
        return {
          x: d.x,
          y: d.y,
          r: d.r,
          base: d.base
        };
      });

      return _react2.default.createElement(
        _reactMove.Animate,
        {
          'default': {
            data: data,
            barSize: barSize,
            barOffset: barOffset,
            visibility: 0
          },
          data: {
            data: data,
            barSize: barSize,
            barOffset: barOffset,
            visibility: visibility
          }
        },
        function (inter) {
          var seriesInteractionProps = interaction === 'series' ? {
            onClick: function onClick() {
              return _this2.selectSeries(series);
            },
            onMouseEnter: function onMouseEnter() {
              return _this2.hoverSeries(series);
            },
            onMouseMove: function onMouseMove() {
              return _this2.hoverSeries(series);
            },
            onMouseLeave: function onMouseLeave() {
              return _this2.hoverSeries(null);
            }
          } : {};
          return _react2.default.createElement(
            'g',
            { className: 'series bar' },
            series.data.map(function (datum, i) {
              var x1 = void 0,
                  y1 = void 0,
                  x2 = void 0,
                  y2 = void 0;
              if (primaryAxis.vertical) {
                x1 = inter.data[i].base;
                x2 = inter.data[i].x;
                y1 = inter.data[i].y + inter.barOffset;
                y2 = y1 + inter.barSize;
              } else {
                x1 = inter.data[i].x + inter.barOffset;
                x2 = x1 + inter.barSize;
                y1 = inter.data[i].y;
                y2 = inter.data[i].base;
              }

              var status = _Utils2.default.datumStatus(series, datum, hovered, selected);
              var dataStyle = _Utils2.default.getStatusStyle(status, datum.statusStyles);

              var datumInteractionProps = interaction === 'element' ? {
                onClick: function onClick() {
                  return _this2.selectDatum(datum);
                },
                onMouseEnter: function onMouseEnter() {
                  return _this2.hoverDatum(datum);
                },
                onMouseMove: function onMouseMove() {
                  return _this2.hoverDatum(datum);
                },
                onMouseLeave: function onMouseLeave() {
                  return _this2.hoverDatum(null);
                }
              } : {};

              return _react2.default.createElement(_Rectangle2.default, _extends({
                style: _extends({}, style, style.rectangle, dataStyle, dataStyle.rectangle),
                key: i,
                x1: isNaN(x1) ? null : x1,
                y1: isNaN(y1) ? null : y1,
                x2: isNaN(x2) ? null : x2,
                y2: isNaN(y2) ? null : y2,
                opacity: inter.visibility
              }, seriesInteractionProps, datumInteractionProps));
            })
          );
        }
      );
    }
  }]);

  return Bars;
}(_react.PureComponent);

exports.default = (0, _reactState.Connect)(function () {
  var selectors = {
    primaryAxis: _Selectors2.default.primaryAxis()
  };
  return function (state, props) {
    return {
      primaryAxis: selectors.primaryAxis(state),
      hovered: state.hovered,
      selected: state.selected,
      interaction: state.interaction
    };
  };
}, {
  filter: function filter(oldState, newState, meta) {
    return meta.type !== 'cursor';
  },
  statics: {
    SeriesType: 'Bar'
  }
})(Bars);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL0Jhci5qcyJdLCJuYW1lcyI6WyJCYXJzIiwic2VsZWN0U2VyaWVzIiwiYmluZCIsImhvdmVyU2VyaWVzIiwic2VsZWN0RGF0dW0iLCJob3ZlckRhdHVtIiwicHJvcHMiLCJzZXJpZXMiLCJ2aXNpYmlsaXR5IiwicHJpbWFyeUF4aXMiLCJzZWxlY3RlZCIsImhvdmVyZWQiLCJpbnRlcmFjdGlvbiIsInN0YXR1cyIsInNlcmllc1N0YXR1cyIsInN0eWxlIiwiZ2V0U3RhdHVzU3R5bGUiLCJzdGF0dXNTdHlsZXMiLCJiYXJTaXplIiwiYmFyT2Zmc2V0IiwiZGF0YSIsIm1hcCIsIngiLCJkIiwieSIsInIiLCJiYXNlIiwic2VyaWVzSW50ZXJhY3Rpb25Qcm9wcyIsIm9uQ2xpY2siLCJvbk1vdXNlRW50ZXIiLCJvbk1vdXNlTW92ZSIsIm9uTW91c2VMZWF2ZSIsImRhdHVtIiwiaSIsIngxIiwieTEiLCJ4MiIsInkyIiwidmVydGljYWwiLCJpbnRlciIsImRhdHVtU3RhdHVzIiwiZGF0YVN0eWxlIiwiZGF0dW1JbnRlcmFjdGlvblByb3BzIiwicmVjdGFuZ2xlIiwiaXNOYU4iLCJzZWxlY3RvcnMiLCJzdGF0ZSIsImZpbHRlciIsIm9sZFN0YXRlIiwibmV3U3RhdGUiLCJtZXRhIiwidHlwZSIsInN0YXRpY3MiLCJTZXJpZXNUeXBlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQTs7QUFDQTs7QUFFQTs7OztBQUNBOzs7O0FBQ0E7O0FBT0E7Ozs7Ozs7Ozs7O0FBVkE7OztJQVlNQSxJOzs7QUFDSixrQkFBZTtBQUFBOztBQUFBOztBQUViLFVBQUtDLFlBQUwsR0FBb0IsaUNBQWFDLElBQWIsT0FBcEI7QUFDQSxVQUFLQyxXQUFMLEdBQW1CLGdDQUFZRCxJQUFaLE9BQW5CO0FBQ0EsVUFBS0UsV0FBTCxHQUFtQixnQ0FBWUYsSUFBWixPQUFuQjtBQUNBLFVBQUtHLFVBQUwsR0FBa0IsK0JBQVdILElBQVgsT0FB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UjtBQUVMbkMsZUFBU21DLE1BQU1uQyxPQUZWO0FBR0xELGdCQUFVb0MsTUFBTXBDLFFBSFg7QUFJTEUsbUJBQWFrQyxNQUFNbEM7QUFKZCxLQUFQO0FBTUQsR0FQRDtBQVFELENBYlksRUFjYjtBQUNFbUMsVUFBUSxnQkFBQ0MsUUFBRCxFQUFXQyxRQUFYLEVBQXFCQyxJQUFyQjtBQUFBLFdBQThCQSxLQUFLQyxJQUFMLEtBQWMsUUFBNUM7QUFBQSxHQURWO0FBRUVDLFdBQVM7QUFDUEMsZ0JBQVk7QUFETDtBQUZYLENBZGEsRUFvQmJyRCxJQXBCYSxDIiwiZmlsZSI6IkJhci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBQdXJlQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBDb25uZWN0IH0gZnJvbSAncmVhY3Qtc3RhdGUnXG5pbXBvcnQgeyBBbmltYXRlIH0gZnJvbSAncmVhY3QtbW92ZSdcbi8vXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vdXRpbHMvVXRpbHMnXG5pbXBvcnQgU2VsZWN0b3JzIGZyb20gJy4uL3V0aWxzL1NlbGVjdG9ycydcbmltcG9ydCB7XG4gIHNlbGVjdFNlcmllcyxcbiAgaG92ZXJTZXJpZXMsXG4gIHNlbGVjdERhdHVtLFxuICBob3ZlckRhdHVtLFxufSBmcm9tICcuLi91dGlscy9pbnRlcmFjdGlvbk1ldGhvZHMnXG5cbmltcG9ydCBSZWN0YW5nbGUgZnJvbSAnLi4vcHJpbWl0aXZlcy9SZWN0YW5nbGUnXG5cbmNsYXNzIEJhcnMgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKClcbiAgICB0aGlzLnNlbGVjdFNlcmllcyA9IHNlbGVjdFNlcmllcy5iaW5kKHRoaXMpXG4gICAgdGhpcy5ob3ZlclNlcmllcyA9IGhvdmVyU2VyaWVzLmJpbmQodGhpcylcbiAgICB0aGlzLnNlbGVjdERhdHVtID0gc2VsZWN0RGF0dW0uYmluZCh0aGlzKVxuICAgIHRoaXMuaG92ZXJEYXR1bSA9IGhvdmVyRGF0dW0uYmluZCh0aGlzKVxuICB9XG4gIHJlbmRlciAoKSB7XG4gICAgY29uc3Qge1xuICAgICAgc2VyaWVzLFxuICAgICAgdmlzaWJpbGl0eSxcbiAgICAgIC8vXG4gICAgICBwcmltYXJ5QXhpcyxcbiAgICAgIHNlbGVjdGVkLFxuICAgICAgaG92ZXJlZCxcbiAgICAgIGludGVyYWN0aW9uLFxuICAgIH0gPSB0aGlzLnByb3BzXG5cbiAgICBjb25zdCBzdGF0dXMgPSBVdGlscy5zZXJpZXNTdGF0dXMoc2VyaWVzLCBob3ZlcmVkLCBzZWxlY3RlZClcbiAgICBjb25zdCBzdHlsZSA9IFV0aWxzLmdldFN0YXR1c1N0eWxlKHN0YXR1cywgc2VyaWVzLnN0YXR1c1N0eWxlcylcblxuICAgIGNvbnN0IGJhclNpemUgPSBwcmltYXJ5QXhpcy5iYXJTaXplXG4gICAgY29uc3QgYmFyT2Zmc2V0ID0gcHJpbWFyeUF4aXMuYmFyT2Zmc2V0XG5cbiAgICBjb25zdCBkYXRhID0gc2VyaWVzLmRhdGEubWFwKGQgPT4gKHtcbiAgICAgIHg6IGQueCxcbiAgICAgIHk6IGQueSxcbiAgICAgIHI6IGQucixcbiAgICAgIGJhc2U6IGQuYmFzZSxcbiAgICB9KSlcblxuICAgIHJldHVybiAoXG4gICAgICA8QW5pbWF0ZVxuICAgICAgICBkZWZhdWx0PXt7XG4gICAgICAgICAgZGF0YSxcbiAgICAgICAgICBiYXJTaXplLFxuICAgICAgICAgIGJhck9mZnNldCxcbiAgICAgICAgICB2aXNpYmlsaXR5OiAwLFxuICAgICAgICB9fVxuICAgICAgICBkYXRhPXt7XG4gICAgICAgICAgZGF0YSxcbiAgICAgICAgICBiYXJTaXplLFxuICAgICAgICAgIGJhck9mZnNldCxcbiAgICAgICAgICB2aXNpYmlsaXR5LFxuICAgICAgICB9fVxuICAgICAgPlxuICAgICAgICB7aW50ZXIgPT4ge1xuICAgICAgICAgIGNvbnN0IHNlcmllc0ludGVyYWN0aW9uUHJvcHMgPSBpbnRlcmFjdGlvbiA9PT0gJ3NlcmllcydcbiAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiB0aGlzLnNlbGVjdFNlcmllcyhzZXJpZXMpLFxuICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI6ICgpID0+IHRoaXMuaG92ZXJTZXJpZXMoc2VyaWVzKSxcbiAgICAgICAgICAgICAgb25Nb3VzZU1vdmU6ICgpID0+IHRoaXMuaG92ZXJTZXJpZXMoc2VyaWVzKSxcbiAgICAgICAgICAgICAgb25Nb3VzZUxlYXZlOiAoKSA9PiB0aGlzLmhvdmVyU2VyaWVzKG51bGwpLFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgOiB7fVxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZyBjbGFzc05hbWU9J3NlcmllcyBiYXInPlxuICAgICAgICAgICAgICB7c2VyaWVzLmRhdGEubWFwKChkYXR1bSwgaSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCB4MSwgeTEsIHgyLCB5MlxuICAgICAgICAgICAgICAgIGlmIChwcmltYXJ5QXhpcy52ZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgICAgeDEgPSBpbnRlci5kYXRhW2ldLmJhc2VcbiAgICAgICAgICAgICAgICAgIHgyID0gaW50ZXIuZGF0YVtpXS54XG4gICAgICAgICAgICAgICAgICB5MSA9IGludGVyLmRhdGFbaV0ueSArIGludGVyLmJhck9mZnNldFxuICAgICAgICAgICAgICAgICAgeTIgPSB5MSArIGludGVyLmJhclNpemVcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgeDEgPSBpbnRlci5kYXRhW2ldLnggKyBpbnRlci5iYXJPZmZzZXRcbiAgICAgICAgICAgICAgICAgIHgyID0geDEgKyBpbnRlci5iYXJTaXplXG4gICAgICAgICAgICAgICAgICB5MSA9IGludGVyLmRhdGFbaV0ueVxuICAgICAgICAgICAgICAgICAgeTIgPSBpbnRlci5kYXRhW2ldLmJhc2VcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBVdGlscy5kYXR1bVN0YXR1cyhcbiAgICAgICAgICAgICAgICAgIHNlcmllcyxcbiAgICAgICAgICAgICAgICAgIGRhdHVtLFxuICAgICAgICAgICAgICAgICAgaG92ZXJlZCxcbiAgICAgICAgICAgICAgICAgIHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFTdHlsZSA9IFV0aWxzLmdldFN0YXR1c1N0eWxlKFxuICAgICAgICAgICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgZGF0dW0uc3RhdHVzU3R5bGVzXG4gICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0dW1JbnRlcmFjdGlvblByb3BzID0gaW50ZXJhY3Rpb24gPT09ICdlbGVtZW50J1xuICAgICAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHRoaXMuc2VsZWN0RGF0dW0oZGF0dW0pLFxuICAgICAgICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI6ICgpID0+IHRoaXMuaG92ZXJEYXR1bShkYXR1bSksXG4gICAgICAgICAgICAgICAgICAgIG9uTW91c2VNb3ZlOiAoKSA9PiB0aGlzLmhvdmVyRGF0dW0oZGF0dW0pLFxuICAgICAgICAgICAgICAgICAgICBvbk1vdXNlTGVhdmU6ICgpID0+IHRoaXMuaG92ZXJEYXR1bShudWxsKSxcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIDoge31cblxuICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICA8UmVjdGFuZ2xlXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgLi4uc3R5bGUsXG4gICAgICAgICAgICAgICAgICAgICAgLi4uc3R5bGUucmVjdGFuZ2xlLFxuICAgICAgICAgICAgICAgICAgICAgIC4uLmRhdGFTdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAuLi5kYXRhU3R5bGUucmVjdGFuZ2xlLFxuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICBrZXk9e2l9XG4gICAgICAgICAgICAgICAgICAgIHgxPXtpc05hTih4MSkgPyBudWxsIDogeDF9XG4gICAgICAgICAgICAgICAgICAgIHkxPXtpc05hTih5MSkgPyBudWxsIDogeTF9XG4gICAgICAgICAgICAgICAgICAgIHgyPXtpc05hTih4MikgPyBudWxsIDogeDJ9XG4gICAgICAgICAgICAgICAgICAgIHkyPXtpc05hTih5MikgPyBudWxsIDogeTJ9XG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk9e2ludGVyLnZpc2liaWxpdHl9XG4gICAgICAgICAgICAgICAgICAgIHsuLi5zZXJpZXNJbnRlcmFjdGlvblByb3BzfVxuICAgICAgICAgICAgICAgICAgICB7Li4uZGF0dW1JbnRlcmFjdGlvblByb3BzfVxuICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC9nPlxuICAgICAgICAgIClcbiAgICAgICAgfX1cbiAgICAgIDwvQW5pbWF0ZT5cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ29ubmVjdChcbiAgKCkgPT4ge1xuICAgIGNvbnN0IHNlbGVjdG9ycyA9IHtcbiAgICAgIHByaW1hcnlBeGlzOiBTZWxlY3RvcnMucHJpbWFyeUF4aXMoKSxcbiAgICB9XG4gICAgcmV0dXJuIChzdGF0ZSwgcHJvcHMpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByaW1hcnlBeGlzOiBzZWxlY3RvcnMucHJpbWFyeUF4aXMoc3RhdGUpLFxuICAgICAgICBob3ZlcmVkOiBzdGF0ZS5ob3ZlcmVkLFxuICAgICAgICBzZWxlY3RlZDogc3RhdGUuc2VsZWN0ZWQsXG4gICAgICAgIGludGVyYWN0aW9uOiBzdGF0ZS5pbnRlcmFjdGlvbixcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHtcbiAgICBmaWx0ZXI6IChvbGRTdGF0ZSwgbmV3U3RhdGUsIG1ldGEpID0+IG1ldGEudHlwZSAhPT0gJ2N1cnNvcicsXG4gICAgc3RhdGljczoge1xuICAgICAgU2VyaWVzVHlwZTogJ0JhcicsXG4gICAgfSxcbiAgfVxuKShCYXJzKVxuIl19