'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactMove = require('react-move');

var _raf = require('raf');

var _raf2 = _interopRequireDefault(_raf);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

_reactMove.Animate.defaults.immutable = false;

exports.default = {
  requestAnimationFrame: _raf2.default,
  throttle: throttle,
  seriesStatus: seriesStatus,
  datumStatus: datumStatus,
  getStatusStyles: getStatusStyles,
  getStatusStyle: getStatusStyle,
  getCenterPointOfSide: getCenterPointOfSide,
  getClosestPoint: getClosestPoint,
  normalizeComponent: normalizeComponent,
  materializeStyles: materializeStyles,
  normalizeGetter: normalizeGetter,
  normalizePathGetter: normalizePathGetter,
  get: get,
  mapValues: mapValues,
  uniq: uniq,
  groupBy: groupBy,
  orderBy: orderBy,
  isArray: isArray
};


function throttle(func) {
  var running = void 0;
  return function () {
    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    if (running) return;
    running = (0, _raf2.default)(function () {
      func.apply(undefined, args);
      running = false;
    });
  };
}

function seriesStatus(series, hovered, selected) {
  var status = {
    selected: false,
    hovered: false,
    otherSelected: false,
    otherHovered: false
  };
  if (selected && selected.active && selected.series) {
    status.selected = selected.series.id === series.id;
    status.otherSelected = !status.selected;
  }
  if (hovered && hovered.active && hovered.series) {
    status.hovered = hovered.series.id === series.id;
    status.otherHovered = !status.hovered;
  }

  return status;
}

function datumStatus(series, datum, hovered, selected) {
  var status = {
    selected: false,
    hovered: false,
    otherSelected: false,
    otherHovered: false
  };

  var d = void 0;
  if (selected && selected.active && selected.datums) {
    for (var i = 0; i < selected.datums.length; i++) {
      d = selected.datums[i];
      if (d.seriesID === series.id && d.index === datum.index) {
        status.selected = true;
        break;
      }
    }
    status.otherSelected = !status.selected;
  }
  if (hovered && hovered.active && hovered.datums) {
    for (var _i = 0; _i < hovered.datums.length; _i++) {
      d = hovered.datums[_i];
      if (d.seriesID === series.id && d.index === datum.index) {
        status.hovered = true;
        break;
      }
    }
    status.otherHovered = !status.hovered;
  }

  return status;
}

function getStatusStyles(item, decorator, defaults) {
  var styles = {
    default: decorator(item),
    selected: decorator(_extends({}, item, {
      selected: true
    })),
    selectedHovered: decorator(_extends({}, item, {
      selected: true,
      hovered: true
    })),
    selectedOtherHovered: decorator(_extends({}, item, {
      selected: true,
      otherHovered: true
    })),
    otherSelected: decorator(_extends({}, item, {
      otherSelected: true
    })),
    otherSelectedHovered: decorator(_extends({}, item, {
      otherSelected: true,
      hovered: true
    })),
    otherSelectedOtherHovered: decorator(_extends({}, item, {
      otherHovered: true,
      otherSelected: true
    })),
    hovered: decorator(_extends({}, item, {
      hovered: true
    })),
    otherHovered: decorator(_extends({}, item, {
      otherHovered: true
    }))
  };
  Object.keys(styles).forEach(function (key) {
    styles[key] = materializeStyles(styles[key], defaults);
  });
  return styles;
}

function getStatusStyle(status, styles) {
  if (status.selected) {
    if (status.hovered) {
      return styles.selectedHovered;
    }
    return styles.selected;
  }
  if (status.hovered) {
    return styles.hovered;
  }
  return styles.default;
}

function getCenterPointOfSide(position, points) {
  var xMin = void 0,
      xMax = void 0,
      yMin = void 0,
      yMax = void 0;

  xMin = points[0].focus.x;
  xMax = points[0].focus.x;
  yMin = points[0].focus.y;
  yMax = points[0].focus.y;

  points.forEach(function (point) {
    xMin = Math.min(point.focus.x, xMin);
    xMax = Math.max(point.focus.x, xMax);
    yMin = Math.min(point.focus.y, yMin);
    yMax = Math.max(point.focus.y, yMax);
  });

  if (position === 'left') {
    return {
      x: xMin,
      y: (yMin + yMax) / 2
    };
  }
  if (position === 'right') {
    return {
      x: xMax,
      y: (yMin + yMax) / 2
    };
  }
  if (position === 'top') {
    return {
      x: (xMin + xMax) / 2,
      y: yMin
    };
  }
  if (position === 'bottom') {
    return {
      x: (xMin + xMax) / 2,
      y: yMax
    };
  }
  // Center
  return {
    x: (xMin + xMax) / 2,
    y: (yMin + yMax) / 2
  };
}

function getClosestPoint(position, points) {
  var closestDistance = Infinity;
  var closestPoint = points[0] || {};
  points.forEach(function (p) {
    var distance = Math.sqrt(Math.pow(p.focus.x - position.x, 2) + Math.pow(p.focus.y - position.y, 2));
    if (distance < closestDistance) {
      closestDistance = distance;
      closestPoint = p;
    }
  });
  return closestPoint;
}

function normalizeComponent(Comp) {
  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var fallback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Comp;

  return typeof Comp === 'function' ? Object.getPrototypeOf(Comp).isReactComponent ? _react2.default.createElement(Comp, params) : Comp(params) : fallback;
}

function materializeStyles() {
  var style = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var defaults = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  style = _extends({}, style, {
    stroke: style.stroke || style.color || defaults.stroke || defaults.color,
    fill: style.fill || style.color || defaults.fill || defaults.color
  });['area', 'line', 'rectangle', 'circle'].forEach(function (type) {
    style[type] = style[type] ? materializeStyles(style[type], defaults) : {};
  });
  return style;
}

function normalizeGetter(getter) {
  if (!getter) {
    return;
  }
  if (typeof getter === 'function') {
    return getter;
  }
  return function () {
    return getter;
  };
}

function normalizePathGetter(getter) {
  if (typeof getter === 'function') {
    return getter;
  }
  return function (d, i) {
    return get(d, getter);
  };
}

function get(obj, path, def) {
  if (typeof obj === 'function') {
    try {
      return obj();
    } catch (e) {
      return path;
    }
  }
  if (!path) {
    return obj;
  }
  var pathObj = makePathArray(path);
  var val = void 0;
  try {
    val = pathObj.reduce(function (current, pathPart) {
      return current[pathPart];
    }, obj);
  } catch (e) {}
  return typeof val !== 'undefined' ? val : def;
}

function mapValues(obj, cb) {
  var newObj = {};
  for (var prop in obj) {
    if (obj.hasOwnProperty(prop)) {
      newObj[prop] = cb(obj[prop], prop, obj);
    }
  }
  return newObj;
}

function uniq(arr) {
  return arr.filter(function (d, i) {
    return arr.filter(function (dd) {
      return dd === d;
    }).length === 1;
  });
}

function groupBy(xs, key) {
  return xs.reduce(function (rv, x, i) {
    var resKey = typeof key === 'function' ? key(x, i) : x[key];
    rv[resKey] = isArray(rv[resKey]) ? rv[resKey] : [];
    rv[resKey].push(x);
    return rv;
  }, {});
}

function orderBy(arr, funcs) {
  var dirs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];

  funcs = isArray(funcs) ? funcs : [funcs];
  return arr.sort(function (a, b) {
    for (var i = 0; i < funcs.length; i++) {
      var comp = funcs[i];
      var ca = comp(a);
      var cb = comp(b);
      var desc = dirs[i] === false || dirs[i] === 'desc';
      if (ca > cb) {
        return desc ? -1 : 1;
      }
      if (ca < cb) {
        return desc ? 1 : -1;
      }
    }
    return dirs[0] ? a.__index - b.__index : b.__index - b.__index;
  });
}

function isArray(a) {
  return Array.isArray(a);
}

// ########################################################################
// Non-exported Helpers
// ########################################################################

function makePathArray(obj) {
  return flattenDeep(obj).join('.').replace('[', '.').replace(']', '').split('.');
}

function flattenDeep(arr) {
  var newArr = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

  if (!isArray(arr)) {
    newArr.push(arr);
  } else {
    for (var i = 0; i < arr.length; i++) {
      flattenDeep(arr[i], newArr);
    }
  }
  return newArr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9VdGlscy5qcyJdLCJuYW1lcyI6WyJkZWZhdWx0cyIsImltbXV0YWJsZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInRocm90dGxlIiwic2VyaWVzU3RhdHVzIiwiZGF0dW1TdGF0dXMiLCJnZXRTdGF0dXNTdHlsZXMiLCJnZXRTdGF0dXNTdHlsZSIsImdldENlbnRlclBvaW50T2ZTaWRlIiwiZ2V0Q2xvc2VzdFBvaW50Iiwibm9ybWFsaXplQ29tcG9uZW50IiwibWF0ZXJpYWxpemVTdHlsZXMiLCJub3JtYWxpemVHZXR0ZXIiLCJub3JtYWxpemVQYXRoR2V0dGVyIiwiZ2V0IiwibWFwVmFsdWVzIiwidW5pcSIsImdyb3VwQnkiLCJvcmRlckJ5IiwiaXNBcnJheSIsImZ1bmMiLCJydW5uaW5nIiwiYXJncyIsInNlcmllcyIsImhvdmVyZWQiLCJzZWxlY3RlZCIsInN0YXR1cyIsIm90aGVyU2VsZWN0ZWQiLCJvdGhlckhvdmVyZWQiLCJhY3RpdmUiLCJpZCIsImRhdHVtIiwiZCIsImRhdHVtcyIsImkiLCJsZW5ndGgiLCJzZXJpZXNJRCIsImluZGV4IiwiaXRlbSIsImRlY29yYXRvciIsInN0eWxlcyIsImRlZmF1bHQiLCJzZWxlY3RlZEhvdmVyZWQiLCJzZWxlY3RlZE90aGVySG92ZXJlZCIsIm90aGVyU2VsZWN0ZWRIb3ZlcmVkIiwib3RoZXJTZWxlY3RlZE90aGVySG92ZXJlZCIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwicG9zaXRpb24iLCJwb2ludHMiLCJ4TWluIiwieE1heCIsInlNaW4iLCJ5TWF4IiwiZm9jdXMiLCJ4IiwieSIsIk1hdGgiLCJtaW4iLCJwb2ludCIsIm1heCIsImNsb3Nlc3REaXN0YW5jZSIsIkluZmluaXR5IiwiY2xvc2VzdFBvaW50IiwiZGlzdGFuY2UiLCJzcXJ0IiwicG93IiwicCIsIkNvbXAiLCJwYXJhbXMiLCJmYWxsYmFjayIsImdldFByb3RvdHlwZU9mIiwiaXNSZWFjdENvbXBvbmVudCIsInN0eWxlIiwic3Ryb2tlIiwiY29sb3IiLCJmaWxsIiwidHlwZSIsImdldHRlciIsIm9iaiIsInBhdGgiLCJkZWYiLCJlIiwicGF0aE9iaiIsIm1ha2VQYXRoQXJyYXkiLCJ2YWwiLCJyZWR1Y2UiLCJjdXJyZW50IiwicGF0aFBhcnQiLCJjYiIsIm5ld09iaiIsInByb3AiLCJoYXNPd25Qcm9wZXJ0eSIsImFyciIsImZpbHRlciIsImRkIiwieHMiLCJydiIsInJlc0tleSIsInB1c2giLCJmdW5jcyIsImRpcnMiLCJzb3J0IiwiYSIsImIiLCJjb21wIiwiY2EiLCJkZXNjIiwiX19pbmRleCIsIkFycmF5IiwiZmxhdHRlbkRlZXAiLCJqb2luIiwicmVwbGFjZSIsInNwbGl0IiwibmV3QXJyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVBLG1CQUFRQSxRQUFSLENBQWlCQyxTQUFqQixHQUE2QixLQUE3Qjs7a0JBRWU7QUFDYkMsc0NBRGE7QUFFYkMsb0JBRmE7QUFHYkMsNEJBSGE7QUFJYkMsMEJBSmE7QUFLYkMsa0NBTGE7QUFNYkMsZ0NBTmE7QUFPYkMsNENBUGE7QUFRYkMsa0NBUmE7QUFTYkMsd0NBVGE7QUFVYkMsc0NBVmE7QUFXYkMsa0NBWGE7QUFZYkMsMENBWmE7QUFhYkMsVUFiYTtBQWNiQyxzQkFkYTtBQWViQyxZQWZhO0FBZ0JiQyxrQkFoQmE7QUFpQmJDLGtCQWpCYTtBQWtCYkM7QUFsQmEsQzs7O0FBcUJmLFNBQVNoQixRQUFULENBQW1CaUIsSUFBbkIsRUFBeUI7QUFDdkIsTUFBSUMsZ0JBQUo7QUFDQSxTQUFPLFlBQWE7QUFBQSxzQ0FBVEMsSUFBUztBQUFUQSxVQUFTO0FBQUE7O0FBQ2xCLFFBQUlELE9BQUosRUFBYTtBQUNiQSxjQUFVLG1CQUFJLFlBQU07QUFDbEJELDRCQUFRRSxJQUFSO0FBQ0FELGdCQUFVLEtBQVY7QUFDRCxLQUhTLENBQVY7QUFJRCxHQU5EO0FBT0Q7O0FBRUQsU0FBU2pCLFlBQVQsQ0FBdUJtQixN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RDs7QUFFRDtBQUNBO0FBQ0E7O0FBRUEsU0FBU25CLGFBQVQsQ0FBd0JMLEdBQXhCLEVBQTZCO0FBQzNCLFNBQU8rQixZQUFZL0IsR0FBWixFQUNKZ0MsSUFESSxDQUNDLEdBREQsRUFFSkMsT0FGSSxDQUVJLEdBRkosRUFFUyxHQUZULEVBR0pBLE9BSEksQ0FHSSxHQUhKLEVBR1MsRUFIVCxFQUlKQyxLQUpJLENBSUUsR0FKRixDQUFQO0FBS0Q7O0FBRUQsU0FBU0gsV0FBVCxDQUFzQmpCLEdBQXRCLEVBQXdDO0FBQUEsTUFBYnFCLE1BQWEsdUVBQUosRUFBSTs7QUFDdEMsTUFBSSxDQUFDakcsUUFBUTRFLEdBQVIsQ0FBTCxFQUFtQjtBQUNqQnFCLFdBQU9mLElBQVAsQ0FBWU4sR0FBWjtBQUNELEdBRkQsTUFFTztBQUNMLFNBQUssSUFBSTdELElBQUksQ0FBYixFQUFnQkEsSUFBSTZELElBQUk1RCxNQUF4QixFQUFnQ0QsR0FBaEMsRUFBcUM7QUFDbkM4RSxrQkFBWWpCLElBQUk3RCxDQUFKLENBQVosRUFBb0JrRixNQUFwQjtBQUNEO0FBQ0Y7QUFDRCxTQUFPQSxNQUFQO0FBQ0QiLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBBbmltYXRlIH0gZnJvbSAncmVhY3QtbW92ZSdcbmltcG9ydCBSQUYgZnJvbSAncmFmJ1xuXG5BbmltYXRlLmRlZmF1bHRzLmltbXV0YWJsZSA9IGZhbHNlXG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lOiBSQUYsXG4gIHRocm90dGxlLFxuICBzZXJpZXNTdGF0dXMsXG4gIGRhdHVtU3RhdHVzLFxuICBnZXRTdGF0dXNTdHlsZXMsXG4gIGdldFN0YXR1c1N0eWxlLFxuICBnZXRDZW50ZXJQb2ludE9mU2lkZSxcbiAgZ2V0Q2xvc2VzdFBvaW50LFxuICBub3JtYWxpemVDb21wb25lbnQsXG4gIG1hdGVyaWFsaXplU3R5bGVzLFxuICBub3JtYWxpemVHZXR0ZXIsXG4gIG5vcm1hbGl6ZVBhdGhHZXR0ZXIsXG4gIGdldCxcbiAgbWFwVmFsdWVzLFxuICB1bmlxLFxuICBncm91cEJ5LFxuICBvcmRlckJ5LFxuICBpc0FycmF5LFxufVxuXG5mdW5jdGlvbiB0aHJvdHRsZSAoZnVuYykge1xuICBsZXQgcnVubmluZ1xuICByZXR1cm4gKC4uLmFyZ3MpID0+IHtcbiAgICBpZiAocnVubmluZykgcmV0dXJuXG4gICAgcnVubmluZyA9IFJBRigoKSA9PiB7XG4gICAgICBmdW5jKC4uLmFyZ3MpXG4gICAgICBydW5uaW5nID0gZmFsc2VcbiAgICB9KVxuICB9XG59XG5cbmZ1bmN0aW9uIHNlcmllc1N0YXR1cyAoc2VyaWVzLCBob3ZlcmVkLCBzZWxlY3RlZCkge1xuICBjb25zdCBzdGF0dXMgPSB7XG4gICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgIGhvdmVyZWQ6IGZhbHNlLFxuICAgIG90aGVyU2VsZWN0ZWQ6IGZhbHNlLFxuICAgIG90aGVySG92ZXJlZDogZmFsc2UsXG4gIH1cbiAgaWYgKHNlbGVjdGVkICYmIHNlbGVjdGVkLmFjdGl2ZSAmJiBzZWxlY3RlZC5zZXJpZXMpIHtcbiAgICBzdGF0dXMuc2VsZWN0ZWQgPSBzZWxlY3RlZC5zZXJpZXMuaWQgPT09IHNlcmllcy5pZFxuICAgIHN0YXR1cy5vdGhlclNlbGVjdGVkID0gIXN0YXR1cy5zZWxlY3RlZFxuICB9XG4gIGlmIChob3ZlcmVkICYmIGhvdmVyZWQuYWN0aXZlICYmIGhvdmVyZWQuc2VyaWVzKSB7XG4gICAgc3RhdHVzLmhvdmVyZWQgPSBob3ZlcmVkLnNlcmllcy5pZCA9PT0gc2VyaWVzLmlkXG4gICAgc3RhdHVzLm90aGVySG92ZXJlZCA9ICFzdGF0dXMuaG92ZXJlZFxuICB9XG5cbiAgcmV0dXJuIHN0YXR1c1xufVxuXG5mdW5jdGlvbiBkYXR1bVN0YXR1cyAoc2VyaWVzLCBkYXR1bSwgaG92ZXJlZCwgc2VsZWN0ZWQpIHtcbiAgY29uc3Qgc3RhdHVzID0ge1xuICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICBob3ZlcmVkOiBmYWxzZSxcbiAgICBvdGhlclNlbGVjdGVkOiBmYWxzZSxcbiAgICBvdGhlckhvdmVyZWQ6IGZhbHNlLFxuICB9XG5cbiAgbGV0IGRcbiAgaWYgKHNlbGVjdGVkICYmIHNlbGVjdGVkLmFjdGl2ZSAmJiBzZWxlY3RlZC5kYXR1bXMpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlbGVjdGVkLmRhdHVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgZCA9IHNlbGVjdGVkLmRhdHVtc1tpXVxuICAgICAgaWYgKGQuc2VyaWVzSUQgPT09IHNlcmllcy5pZCAmJiBkLmluZGV4ID09PSBkYXR1bS5pbmRleCkge1xuICAgICAgICBzdGF0dXMuc2VsZWN0ZWQgPSB0cnVlXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG4gICAgfVxuICAgIHN0YXR1cy5vdGhlclNlbGVjdGVkID0gIXN0YXR1cy5zZWxlY3RlZFxuICB9XG4gIGlmIChob3ZlcmVkICYmIGhvdmVyZWQuYWN0aXZlICYmIGhvdmVyZWQuZGF0dW1zKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBob3ZlcmVkLmRhdHVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgZCA9IGhvdmVyZWQuZGF0dW1zW2ldXG4gICAgICBpZiAoZC5zZXJpZXNJRCA9PT0gc2VyaWVzLmlkICYmIGQuaW5kZXggPT09IGRhdHVtLmluZGV4KSB7XG4gICAgICAgIHN0YXR1cy5ob3ZlcmVkID0gdHJ1ZVxuICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cbiAgICBzdGF0dXMub3RoZXJIb3ZlcmVkID0gIXN0YXR1cy5ob3ZlcmVkXG4gIH1cblxuICByZXR1cm4gc3RhdHVzXG59XG5cbmZ1bmN0aW9uIGdldFN0YXR1c1N0eWxlcyAoaXRlbSwgZGVjb3JhdG9yLCBkZWZhdWx0cykge1xuICBjb25zdCBzdHlsZXMgPSB7XG4gICAgZGVmYXVsdDogZGVjb3JhdG9yKGl0ZW0pLFxuICAgIHNlbGVjdGVkOiBkZWNvcmF0b3Ioe1xuICAgICAgLi4uaXRlbSxcbiAgICAgIHNlbGVjdGVkOiB0cnVlLFxuICAgIH0pLFxuICAgIHNlbGVjdGVkSG92ZXJlZDogZGVjb3JhdG9yKHtcbiAgICAgIC4uLml0ZW0sXG4gICAgICBzZWxlY3RlZDogdHJ1ZSxcbiAgICAgIGhvdmVyZWQ6IHRydWUsXG4gICAgfSksXG4gICAgc2VsZWN0ZWRPdGhlckhvdmVyZWQ6IGRlY29yYXRvcih7XG4gICAgICAuLi5pdGVtLFxuICAgICAgc2VsZWN0ZWQ6IHRydWUsXG4gICAgICBvdGhlckhvdmVyZWQ6IHRydWUsXG4gICAgfSksXG4gICAgb3RoZXJTZWxlY3RlZDogZGVjb3JhdG9yKHtcbiAgICAgIC4uLml0ZW0sXG4gICAgICBvdGhlclNlbGVjdGVkOiB0cnVlLFxuICAgIH0pLFxuICAgIG90aGVyU2VsZWN0ZWRIb3ZlcmVkOiBkZWNvcmF0b3Ioe1xuICAgICAgLi4uaXRlbSxcbiAgICAgIG90aGVyU2VsZWN0ZWQ6IHRydWUsXG4gICAgICBob3ZlcmVkOiB0cnVlLFxuICAgIH0pLFxuICAgIG90aGVyU2VsZWN0ZWRPdGhlckhvdmVyZWQ6IGRlY29yYXRvcih7XG4gICAgICAuLi5pdGVtLFxuICAgICAgb3RoZXJIb3ZlcmVkOiB0cnVlLFxuICAgICAgb3RoZXJTZWxlY3RlZDogdHJ1ZSxcbiAgICB9KSxcbiAgICBob3ZlcmVkOiBkZWNvcmF0b3Ioe1xuICAgICAgLi4uaXRlbSxcbiAgICAgIGhvdmVyZWQ6IHRydWUsXG4gICAgfSksXG4gICAgb3RoZXJIb3ZlcmVkOiBkZWNvcmF0b3Ioe1xuICAgICAgLi4uaXRlbSxcbiAgICAgIG90aGVySG92ZXJlZDogdHJ1ZSxcbiAgICB9KSxcbiAgfVxuICBPYmplY3Qua2V5cyhzdHlsZXMpLmZvckVhY2goa2V5ID0+IHtcbiAgICBzdHlsZXNba2V5XSA9IG1hdGVyaWFsaXplU3R5bGVzKHN0eWxlc1trZXldLCBkZWZhdWx0cylcbiAgfSlcbiAgcmV0dXJuIHN0eWxlc1xufVxuXG5mdW5jdGlvbiBnZXRTdGF0dXNTdHlsZSAoc3RhdHVzLCBzdHlsZXMpIHtcbiAgaWYgKHN0YXR1cy5zZWxlY3RlZCkge1xuICAgIGlmIChzdGF0dXMuaG92ZXJlZCkge1xuICAgICAgcmV0dXJuIHN0eWxlcy5zZWxlY3RlZEhvdmVyZWRcbiAgICB9XG4gICAgcmV0dXJuIHN0eWxlcy5zZWxlY3RlZFxuICB9XG4gIGlmIChzdGF0dXMuaG92ZXJlZCkge1xuICAgIHJldHVybiBzdHlsZXMuaG92ZXJlZFxuICB9XG4gIHJldHVybiBzdHlsZXMuZGVmYXVsdFxufVxuXG5mdW5jdGlvbiBnZXRDZW50ZXJQb2ludE9mU2lkZSAocG9zaXRpb24sIHBvaW50cykge1xuICBsZXQgeE1pbiwgeE1heCwgeU1pbiwgeU1heFxuXG4gIHhNaW4gPSBwb2ludHNbMF0uZm9jdXMueFxuICB4TWF4ID0gcG9pbnRzWzBdLmZvY3VzLnhcbiAgeU1pbiA9IHBvaW50c1swXS5mb2N1cy55XG4gIHlNYXggPSBwb2ludHNbMF0uZm9jdXMueVxuXG4gIHBvaW50cy5mb3JFYWNoKHBvaW50ID0+IHtcbiAgICB4TWluID0gTWF0aC5taW4ocG9pbnQuZm9jdXMueCwgeE1pbilcbiAgICB4TWF4ID0gTWF0aC5tYXgocG9pbnQuZm9jdXMueCwgeE1heClcbiAgICB5TWluID0gTWF0aC5taW4ocG9pbnQuZm9jdXMueSwgeU1pbilcbiAgICB5TWF4ID0gTWF0aC5tYXgocG9pbnQuZm9jdXMueSwgeU1heClcbiAgfSlcblxuICBpZiAocG9zaXRpb24gPT09ICdsZWZ0Jykge1xuICAgIHJldHVybiB7XG4gICAgICB4OiB4TWluLFxuICAgICAgeTogKHlNaW4gKyB5TWF4KSAvIDIsXG4gICAgfVxuICB9XG4gIGlmIChwb3NpdGlvbiA9PT0gJ3JpZ2h0Jykge1xuICAgIHJldHVybiB7XG4gICAgICB4OiB4TWF4LFxuICAgICAgeTogKHlNaW4gKyB5TWF4KSAvIDIsXG4gICAgfVxuICB9XG4gIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgeDogKHhNaW4gKyB4TWF4KSAvIDIsXG4gICAgICB5OiB5TWluLFxuICAgIH1cbiAgfVxuICBpZiAocG9zaXRpb24gPT09ICdib3R0b20nKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6ICh4TWluICsgeE1heCkgLyAyLFxuICAgICAgeTogeU1heCxcbiAgICB9XG4gIH1cbiAgLy8gQ2VudGVyXG4gIHJldHVybiB7XG4gICAgeDogKHhNaW4gKyB4TWF4KSAvIDIsXG4gICAgeTogKHlNaW4gKyB5TWF4KSAvIDIsXG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0Q2xvc2VzdFBvaW50IChwb3NpdGlvbiwgcG9pbnRzKSB7XG4gIGxldCBjbG9zZXN0RGlzdGFuY2UgPSBJbmZpbml0eVxuICBsZXQgY2xvc2VzdFBvaW50ID0gcG9pbnRzWzBdIHx8IHt9XG4gIHBvaW50cy5mb3JFYWNoKHAgPT4ge1xuICAgIGNvbnN0IGRpc3RhbmNlID0gTWF0aC5zcXJ0KFxuICAgICAgTWF0aC5wb3cocC5mb2N1cy54IC0gcG9zaXRpb24ueCwgMikgKyBNYXRoLnBvdyhwLmZvY3VzLnkgLSBwb3NpdGlvbi55LCAyKVxuICAgIClcbiAgICBpZiAoZGlzdGFuY2UgPCBjbG9zZXN0RGlzdGFuY2UpIHtcbiAgICAgIGNsb3Nlc3REaXN0YW5jZSA9IGRpc3RhbmNlXG4gICAgICBjbG9zZXN0UG9pbnQgPSBwXG4gICAgfVxuICB9KVxuICByZXR1cm4gY2xvc2VzdFBvaW50XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUNvbXBvbmVudCAoQ29tcCwgcGFyYW1zID0ge30sIGZhbGxiYWNrID0gQ29tcCkge1xuICByZXR1cm4gdHlwZW9mIENvbXAgPT09ICdmdW5jdGlvbidcbiAgICA/IE9iamVjdC5nZXRQcm90b3R5cGVPZihDb21wKS5pc1JlYWN0Q29tcG9uZW50XG4gICAgICA/IDxDb21wIHsuLi5wYXJhbXN9IC8+XG4gICAgICA6IENvbXAocGFyYW1zKVxuICAgIDogZmFsbGJhY2tcbn1cblxuZnVuY3Rpb24gbWF0ZXJpYWxpemVTdHlsZXMgKHN0eWxlID0ge30sIGRlZmF1bHRzID0ge30pIHtcbiAgc3R5bGUgPSB7XG4gICAgLi4uc3R5bGUsXG4gICAgc3Ryb2tlOiBzdHlsZS5zdHJva2UgfHwgc3R5bGUuY29sb3IgfHwgZGVmYXVsdHMuc3Ryb2tlIHx8IGRlZmF1bHRzLmNvbG9yLFxuICAgIGZpbGw6IHN0eWxlLmZpbGwgfHwgc3R5bGUuY29sb3IgfHwgZGVmYXVsdHMuZmlsbCB8fCBkZWZhdWx0cy5jb2xvcixcbiAgfVxuICA7WydhcmVhJywgJ2xpbmUnLCAncmVjdGFuZ2xlJywgJ2NpcmNsZSddLmZvckVhY2godHlwZSA9PiB7XG4gICAgc3R5bGVbdHlwZV0gPSBzdHlsZVt0eXBlXSA/IG1hdGVyaWFsaXplU3R5bGVzKHN0eWxlW3R5cGVdLCBkZWZhdWx0cykgOiB7fVxuICB9KVxuICByZXR1cm4gc3R5bGVcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplR2V0dGVyIChnZXR0ZXIpIHtcbiAgaWYgKCFnZXR0ZXIpIHtcbiAgICByZXR1cm5cbiAgfVxuICBpZiAodHlwZW9mIGdldHRlciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBnZXR0ZXJcbiAgfVxuICByZXR1cm4gKCkgPT4gZ2V0dGVyXG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZVBhdGhHZXR0ZXIgKGdldHRlcikge1xuICBpZiAodHlwZW9mIGdldHRlciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBnZXR0ZXJcbiAgfVxuICByZXR1cm4gKGQsIGkpID0+IGdldChkLCBnZXR0ZXIpXG59XG5cbmZ1bmN0aW9uIGdldCAob2JqLCBwYXRoLCBkZWYpIHtcbiAgaWYgKHR5cGVvZiBvYmogPT09ICdmdW5jdGlvbicpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIG9iaigpXG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIHBhdGhcbiAgICB9XG4gIH1cbiAgaWYgKCFwYXRoKSB7XG4gICAgcmV0dXJuIG9ialxuICB9XG4gIGNvbnN0IHBhdGhPYmogPSBtYWtlUGF0aEFycmF5KHBhdGgpXG4gIGxldCB2YWxcbiAgdHJ5IHtcbiAgICB2YWwgPSBwYXRoT2JqLnJlZHVjZSgoY3VycmVudCwgcGF0aFBhcnQpID0+IGN1cnJlbnRbcGF0aFBhcnRdLCBvYmopXG4gIH0gY2F0Y2ggKGUpIHt9XG4gIHJldHVybiB0eXBlb2YgdmFsICE9PSAndW5kZWZpbmVkJyA/IHZhbCA6IGRlZlxufVxuXG5mdW5jdGlvbiBtYXBWYWx1ZXMgKG9iaiwgY2IpIHtcbiAgY29uc3QgbmV3T2JqID0ge31cbiAgZm9yICh2YXIgcHJvcCBpbiBvYmopIHtcbiAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICBuZXdPYmpbcHJvcF0gPSBjYihvYmpbcHJvcF0sIHByb3AsIG9iailcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5ld09ialxufVxuXG5mdW5jdGlvbiB1bmlxIChhcnIpIHtcbiAgcmV0dXJuIGFyci5maWx0ZXIoKGQsIGkpID0+IGFyci5maWx0ZXIoZGQgPT4gZGQgPT09IGQpLmxlbmd0aCA9PT0gMSlcbn1cblxuZnVuY3Rpb24gZ3JvdXBCeSAoeHMsIGtleSkge1xuICByZXR1cm4geHMucmVkdWNlKChydiwgeCwgaSkgPT4ge1xuICAgIGNvbnN0IHJlc0tleSA9IHR5cGVvZiBrZXkgPT09ICdmdW5jdGlvbicgPyBrZXkoeCwgaSkgOiB4W2tleV1cbiAgICBydltyZXNLZXldID0gaXNBcnJheShydltyZXNLZXldKSA/IHJ2W3Jlc0tleV0gOiBbXVxuICAgIHJ2W3Jlc0tleV0ucHVzaCh4KVxuICAgIHJldHVybiBydlxuICB9LCB7fSlcbn1cblxuZnVuY3Rpb24gb3JkZXJCeSAoYXJyLCBmdW5jcywgZGlycyA9IFtdKSB7XG4gIGZ1bmNzID0gaXNBcnJheShmdW5jcykgPyBmdW5jcyA6IFtmdW5jc11cbiAgcmV0dXJuIGFyci5zb3J0KChhLCBiKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmdW5jcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY29tcCA9IGZ1bmNzW2ldXG4gICAgICBjb25zdCBjYSA9IGNvbXAoYSlcbiAgICAgIGNvbnN0IGNiID0gY29tcChiKVxuICAgICAgY29uc3QgZGVzYyA9IGRpcnNbaV0gPT09IGZhbHNlIHx8IGRpcnNbaV0gPT09ICdkZXNjJ1xuICAgICAgaWYgKGNhID4gY2IpIHtcbiAgICAgICAgcmV0dXJuIGRlc2MgPyAtMSA6IDFcbiAgICAgIH1cbiAgICAgIGlmIChjYSA8IGNiKSB7XG4gICAgICAgIHJldHVybiBkZXNjID8gMSA6IC0xXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkaXJzWzBdID8gYS5fX2luZGV4IC0gYi5fX2luZGV4IDogYi5fX2luZGV4IC0gYi5fX2luZGV4XG4gIH0pXG59XG5cbmZ1bmN0aW9uIGlzQXJyYXkgKGEpIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkoYSlcbn1cblxuLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBOb24tZXhwb3J0ZWQgSGVscGVyc1xuLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG5cbmZ1bmN0aW9uIG1ha2VQYXRoQXJyYXkgKG9iaikge1xuICByZXR1cm4gZmxhdHRlbkRlZXAob2JqKVxuICAgIC5qb2luKCcuJylcbiAgICAucmVwbGFjZSgnWycsICcuJylcbiAgICAucmVwbGFjZSgnXScsICcnKVxuICAgIC5zcGxpdCgnLicpXG59XG5cbmZ1bmN0aW9uIGZsYXR0ZW5EZWVwIChhcnIsIG5ld0FyciA9IFtdKSB7XG4gIGlmICghaXNBcnJheShhcnIpKSB7XG4gICAgbmV3QXJyLnB1c2goYXJyKVxuICB9IGVsc2Uge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmbGF0dGVuRGVlcChhcnJbaV0sIG5ld0FycilcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5ld0FyclxufVxuIl19